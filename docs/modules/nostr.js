var li=Object.defineProperty;var ro=(e,t)=>{for(var n in t)li(e,n,{get:t[n],enumerable:!0})};function oo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function $n(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function so(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");oo(e.outputLen),oo(e.blockLen)}function ge(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function io(e,t){$n(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var je=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var co=e=>e instanceof Uint8Array;var Ze=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),bt=(e,t)=>e<<32-t|e>>>t,di=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!di)throw new Error("Non little-endian hardware is not supported");function hi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ue(e){if(typeof e=="string"&&(e=hi(e)),!co(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function fo(...e){let t=new Uint8Array(e.reduce((r,o)=>r+o.length,0)),n=0;return e.forEach(r=>{if(!co(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var be=class{clone(){return this._cloneInto()}},Xf={}.toString;function ao(e){let t=r=>e().update(Ue(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function ze(e=32){if(je&&typeof je.getRandomValues=="function")return je.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function pi(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),f=r?4:0,a=r?0:4;e.setUint32(t+f,i,r),e.setUint32(t+a,c,r)}var We=class extends be{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ze(this.buffer)}update(t){ge(this);let{view:n,buffer:r,blockLen:o}=this;t=Ue(t);let s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let f=Ze(t);for(;o<=s-i;i+=o)this.process(f,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ge(this),io(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;pi(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=Ze(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let a=f/4,u=this.get();if(a>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<a;l++)c.setUint32(4*l,u[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};var gi=(e,t,n)=>e&t^~e&n,bi=(e,t,n)=>e&t^e&n^t&n,xi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$t=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vt=new Uint32Array(64),Vn=class extends We{constructor(){super(64,32,8,!1),this.A=$t[0]|0,this.B=$t[1]|0,this.C=$t[2]|0,this.D=$t[3]|0,this.E=$t[4]|0,this.F=$t[5]|0,this.G=$t[6]|0,this.H=$t[7]|0}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:f}=this;return[t,n,r,o,s,i,c,f]}set(t,n,r,o,s,i,c,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=f|0}process(t,n){for(let l=0;l<16;l++,n+=4)Vt[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let b=Vt[l-15],g=Vt[l-2],p=bt(b,7)^bt(b,18)^b>>>3,d=bt(g,17)^bt(g,19)^g>>>10;Vt[l]=d+Vt[l-7]+p+Vt[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:f,G:a,H:u}=this;for(let l=0;l<64;l++){let b=bt(c,6)^bt(c,11)^bt(c,25),g=u+b+gi(c,f,a)+xi[l]+Vt[l]|0,d=(bt(r,2)^bt(r,13)^bt(r,22))+bi(r,o,s)|0;u=a,a=f,f=c,c=i+g|0,i=s,s=o,o=r,r=g+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,f=f+this.F|0,a=a+this.G|0,u=u+this.H|0,this.set(r,o,s,i,c,f,a,u)}roundClean(){Vt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ge=ao(()=>new Vn);var Mn={};ro(Mn,{bitGet:()=>Ai,bitLen:()=>vi,bitMask:()=>Oe,bitSet:()=>Si,bytesToHex:()=>ne,bytesToNumberBE:()=>et,bytesToNumberLE:()=>Qe,concatBytes:()=>It,createHmacDrbg:()=>Pn,ensureBytes:()=>J,equalBytes:()=>Ei,hexToBytes:()=>re,hexToNumber:()=>Kn,numberToBytesBE:()=>xt,numberToBytesLE:()=>Je,numberToHexUnpadded:()=>ho,numberToVarBytesBE:()=>mi,utf8ToBytes:()=>Bi,validateObject:()=>Dt});var lo=BigInt(0),Ye=BigInt(1),yi=BigInt(2),Xe=e=>e instanceof Uint8Array,wi=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ne(e){if(!Xe(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=wi[e[n]];return t}function ho(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function Kn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function re(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){let o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function et(e){return Kn(ne(e))}function Qe(e){if(!Xe(e))throw new Error("Uint8Array expected");return Kn(ne(Uint8Array.from(e).reverse()))}function xt(e,t){return re(e.toString(16).padStart(t*2,"0"))}function Je(e,t){return xt(e,t).reverse()}function mi(e){return re(ho(e))}function J(e,t,n){let r;if(typeof t=="string")try{r=re(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Xe(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function It(...e){let t=new Uint8Array(e.reduce((r,o)=>r+o.length,0)),n=0;return e.forEach(r=>{if(!Xe(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Ei(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function vi(e){let t;for(t=0;e>lo;e>>=Ye,t+=1);return t}function Ai(e,t){return e>>BigInt(t)&Ye}var Si=(e,t,n)=>e|(n?Ye:lo)<<BigInt(t),Oe=e=>(yi<<BigInt(e-1))-Ye,Dn=e=>new Uint8Array(e),uo=e=>Uint8Array.from(e);function Pn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Dn(e),o=Dn(e),s=0,i=()=>{r.fill(1),o.fill(0),s=0},c=(...l)=>n(o,r,...l),f=(l=Dn())=>{o=c(uo([0]),l),r=c(),l.length!==0&&(o=c(uo([1]),l),r=c())},a=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,b=[];for(;l<t;){r=c();let g=r.slice();b.push(g),l+=r.length}return It(...b)};return(l,b)=>{i(),f(l);let g;for(;!(g=b(a()));)f();return i(),g}}var Li={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Dt(e,t,n={}){let r=(o,s,i)=>{let c=Li[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);let f=e[o];if(!(i&&f===void 0)&&!c(f,e))throw new Error(`Invalid param ${String(o)}=${f} (${typeof f}), expected ${s}`)};for(let[o,s]of Object.entries(t))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return e}var tt=BigInt(0),X=BigInt(1),oe=BigInt(2),Ti=BigInt(3),jn=BigInt(4),po=BigInt(5),go=BigInt(8),Ii=BigInt(9),Ui=BigInt(16);function F(e,t){let n=e%t;return n>=tt?n:t+n}function Oi(e,t,n){if(n<=tt||t<tt)throw new Error("Expected power/modulo > 0");if(n===X)return tt;let r=X;for(;t>tt;)t&X&&(r=r*e%n),e=e*e%n,t>>=X;return r}function at(e,t,n){let r=e;for(;t-- >tt;)r*=r,r%=n;return r}function Fe(e,t){if(e===tt||t<=tt)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=F(e,t),r=t,o=tt,s=X,i=X,c=tt;for(;n!==tt;){let a=r/n,u=r%n,l=o-i*a,b=s-c*a;r=n,n=u,o=i,s=c,i=l,c=b}if(r!==X)throw new Error("invert: does not exist");return F(o,t)}function _i(e){let t=(e-X)/oe,n,r,o;for(n=e-X,r=0;n%oe===tt;n/=oe,r++);for(o=oe;o<e&&Oi(o,t,e)!==e-X;o++);if(r===1){let i=(e+X)/jn;return function(f,a){let u=f.pow(a,i);if(!f.eql(f.sqr(u),a))throw new Error("Cannot find square root");return u}}let s=(n+X)/oe;return function(c,f){if(c.pow(f,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let a=r,u=c.pow(c.mul(c.ONE,o),n),l=c.pow(f,s),b=c.pow(f,n);for(;!c.eql(b,c.ONE);){if(c.eql(b,c.ZERO))return c.ZERO;let g=1;for(let d=c.sqr(b);g<a&&!c.eql(d,c.ONE);g++)d=c.sqr(d);let p=c.pow(u,X<<BigInt(a-g-1));u=c.sqr(p),l=c.mul(l,p),b=c.mul(b,u),a=g}return l}}function Hi(e){if(e%jn===Ti){let t=(e+X)/jn;return function(r,o){let s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%go===po){let t=(e-po)/go;return function(r,o){let s=r.mul(o,oe),i=r.pow(s,t),c=r.mul(o,i),f=r.mul(r.mul(c,oe),i),a=r.mul(c,r.sub(f,r.ONE));if(!r.eql(r.sqr(a),o))throw new Error("Cannot find square root");return a}}return e%Ui,_i(e)}var Ri=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Zn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Ri.reduce((r,o)=>(r[o]="function",r),t);return Dt(e,n)}function Ni(e,t,n){if(n<tt)throw new Error("Expected power > 0");if(n===tt)return e.ONE;if(n===X)return t;let r=e.ONE,o=t;for(;n>tt;)n&X&&(r=e.mul(r,o)),o=e.sqr(o),n>>=X;return r}function ki(e,t){let n=new Array(t.length),r=t.reduce((s,i,c)=>e.is0(i)?s:(n[c]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,c)=>e.is0(i)?s:(n[c]=e.mul(s,n[c]),e.mul(s,i)),o),n}function zn(e,t){let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function bo(e,t,n=!1,r={}){if(e<=tt)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:s}=zn(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=Hi(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Oe(o),ZERO:tt,ONE:X,create:f=>F(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof f}`);return tt<=f&&f<e},is0:f=>f===tt,isOdd:f=>(f&X)===X,neg:f=>F(-f,e),eql:(f,a)=>f===a,sqr:f=>F(f*f,e),add:(f,a)=>F(f+a,e),sub:(f,a)=>F(f-a,e),mul:(f,a)=>F(f*a,e),pow:(f,a)=>Ni(c,f,a),div:(f,a)=>F(f*Fe(a,e),e),sqrN:f=>f*f,addN:(f,a)=>f+a,subN:(f,a)=>f-a,mulN:(f,a)=>f*a,inv:f=>Fe(f,e),sqrt:r.sqrt||(f=>i(c,f)),invertBatch:f=>ki(c,f),cmov:(f,a,u)=>u?a:f,toBytes:f=>n?Je(f,s):xt(f,s),fromBytes:f=>{if(f.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${f.length}`);return n?Qe(f):et(f)}});return Object.freeze(c)}function xo(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Wn(e){let t=xo(e);return t+Math.ceil(t/2)}function yo(e,t,n=!1){let r=e.length,o=xo(t),s=Wn(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let i=n?et(e):Qe(e),c=F(i,t-X)+X;return n?Je(c,o):xt(c,o)}var Ci=BigInt(0),Gn=BigInt(1);function wo(e,t){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,c=o;for(;s>Ci;)s&Gn&&(i=i.add(c)),c=c.double(),s>>=Gn;return i},precomputeWindow(o,s){let{windows:i,windowSize:c}=r(s),f=[],a=o,u=a;for(let l=0;l<i;l++){u=a,f.push(u);for(let b=1;b<c;b++)u=u.add(a),f.push(u);a=u.double()}return f},wNAF(o,s,i){let{windows:c,windowSize:f}=r(o),a=e.ZERO,u=e.BASE,l=BigInt(2**o-1),b=2**o,g=BigInt(o);for(let p=0;p<c;p++){let d=p*f,h=Number(i&l);i>>=g,h>f&&(h-=b,i+=Gn);let y=d,m=d+Math.abs(h)-1,T=p%2!==0,I=h<0;h===0?u=u.add(n(T,s[y])):a=a.add(n(I,s[m]))}return{p:a,f:u}},wNAFCached(o,s,i,c){let f=o._WINDOW_SIZE||1,a=s.get(o);return a||(a=this.precomputeWindow(o,f),f!==1&&s.set(o,c(a))),this.wNAF(f,a,i)}}}function Yn(e){return Zn(e.Fp),Dt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...zn(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function $i(e){let t=Yn(e);Dt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Vi,hexToBytes:Di}=Mn,se={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=se;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Vi(r),l:e.subarray(n+2)}},toSig(e){let{Err:t}=se,n=typeof e=="string"?Di(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");let{d:o,l:s}=se._parseInt(n.subarray(2)),{d:i,l:c}=se._parseInt(s);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){let t=a=>Number.parseInt(a[0],16)&8?"00"+a:a,n=a=>{let u=a.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),o=t(n(e.r)),s=r.length/2,i=o.length/2,c=n(s),f=n(i);return`30${n(i+s+4)}02${f}${o}02${c}${r}`}},Ut=BigInt(0),dt=BigInt(1),la=BigInt(2),mo=BigInt(3),da=BigInt(4);function Ki(e){let t=$i(e),{Fp:n}=t,r=t.toBytes||((p,d,h)=>{let y=d.toAffine();return It(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),o=t.fromBytes||(p=>{let d=p.subarray(1),h=n.fromBytes(d.subarray(0,n.BYTES)),y=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:h,y}});function s(p){let{a:d,b:h}=t,y=n.sqr(p),m=n.mul(y,p);return n.add(n.add(m,n.mul(p,d)),h)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(p){return typeof p=="bigint"&&Ut<p&&p<t.n}function c(p){if(!i(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function f(p){let{allowedPrivateKeyLengths:d,nByteLength:h,wrapPrivateKey:y,n:m}=t;if(d&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=ne(p)),typeof p!="string"||!d.includes(p.length))throw new Error("Invalid key");p=p.padStart(h*2,"0")}let T;try{T=typeof p=="bigint"?p:et(J("private key",p,h))}catch{throw new Error(`private key must be ${h} bytes, hex or bigint, not ${typeof p}`)}return y&&(T=F(T,m)),c(T),T}let a=new Map;function u(p){if(!(p instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,h,y){if(this.px=d,this.py=h,this.pz=y,d==null||!n.isValid(d))throw new Error("x required");if(h==null||!n.isValid(h))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(d){let{x:h,y}=d||{};if(!d||!n.isValid(h)||!n.isValid(y))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");let m=T=>n.eql(T,n.ZERO);return m(h)&&m(y)?l.ZERO:new l(h,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let h=n.invertBatch(d.map(y=>y.pz));return d.map((y,m)=>y.toAffine(h[m])).map(l.fromAffine)}static fromHex(d){let h=l.fromAffine(o(J("pointHex",d)));return h.assertValidity(),h}static fromPrivateKey(d){return l.BASE.multiply(f(d))}_setWindowSize(d){this._WINDOW_SIZE=d,a.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y:h}=this.toAffine();if(!n.isValid(d)||!n.isValid(h))throw new Error("bad point: x or y not FE");let y=n.sqr(h),m=s(d);if(!n.eql(y,m))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);let{px:h,py:y,pz:m}=this,{px:T,py:I,pz:N}=d,U=n.eql(n.mul(h,N),n.mul(T,m)),H=n.eql(n.mul(y,N),n.mul(I,m));return U&&H}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){let{a:d,b:h}=t,y=n.mul(h,mo),{px:m,py:T,pz:I}=this,N=n.ZERO,U=n.ZERO,H=n.ZERO,k=n.mul(m,m),R=n.mul(T,T),V=n.mul(I,I),$=n.mul(m,T);return $=n.add($,$),H=n.mul(m,I),H=n.add(H,H),N=n.mul(d,H),U=n.mul(y,V),U=n.add(N,U),N=n.sub(R,U),U=n.add(R,U),U=n.mul(N,U),N=n.mul($,N),H=n.mul(y,H),V=n.mul(d,V),$=n.sub(k,V),$=n.mul(d,$),$=n.add($,H),H=n.add(k,k),k=n.add(H,k),k=n.add(k,V),k=n.mul(k,$),U=n.add(U,k),V=n.mul(T,I),V=n.add(V,V),k=n.mul(V,$),N=n.sub(N,k),H=n.mul(V,R),H=n.add(H,H),H=n.add(H,H),new l(N,U,H)}add(d){u(d);let{px:h,py:y,pz:m}=this,{px:T,py:I,pz:N}=d,U=n.ZERO,H=n.ZERO,k=n.ZERO,R=t.a,V=n.mul(t.b,mo),$=n.mul(h,T),q=n.mul(y,I),B=n.mul(m,N),v=n.add(h,y),x=n.add(T,I);v=n.mul(v,x),x=n.add($,q),v=n.sub(v,x),x=n.add(h,m);let w=n.add(T,N);return x=n.mul(x,w),w=n.add($,B),x=n.sub(x,w),w=n.add(y,m),U=n.add(I,N),w=n.mul(w,U),U=n.add(q,B),w=n.sub(w,U),k=n.mul(R,x),U=n.mul(V,B),k=n.add(U,k),U=n.sub(q,k),k=n.add(q,k),H=n.mul(U,k),q=n.add($,$),q=n.add(q,$),B=n.mul(R,B),x=n.mul(V,x),q=n.add(q,B),B=n.sub($,B),B=n.mul(R,B),x=n.add(x,B),$=n.mul(q,x),H=n.add(H,$),$=n.mul(w,x),U=n.mul(v,U),U=n.sub(U,$),$=n.mul(v,q),k=n.mul(w,k),k=n.add(k,$),new l(U,H,k)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return g.wNAFCached(this,a,d,h=>{let y=n.invertBatch(h.map(m=>m.pz));return h.map((m,T)=>m.toAffine(y[T])).map(l.fromAffine)})}multiplyUnsafe(d){let h=l.ZERO;if(d===Ut)return h;if(c(d),d===dt)return this;let{endo:y}=t;if(!y)return g.unsafeLadder(this,d);let{k1neg:m,k1:T,k2neg:I,k2:N}=y.splitScalar(d),U=h,H=h,k=this;for(;T>Ut||N>Ut;)T&dt&&(U=U.add(k)),N&dt&&(H=H.add(k)),k=k.double(),T>>=dt,N>>=dt;return m&&(U=U.negate()),I&&(H=H.negate()),H=new l(n.mul(H.px,y.beta),H.py,H.pz),U.add(H)}multiply(d){c(d);let h=d,y,m,{endo:T}=t;if(T){let{k1neg:I,k1:N,k2neg:U,k2:H}=T.splitScalar(h),{p:k,f:R}=this.wNAF(N),{p:V,f:$}=this.wNAF(H);k=g.constTimeNegate(I,k),V=g.constTimeNegate(U,V),V=new l(n.mul(V.px,T.beta),V.py,V.pz),y=k.add(V),m=R.add($)}else{let{p:I,f:N}=this.wNAF(h);y=I,m=N}return l.normalizeZ([y,m])[0]}multiplyAndAddUnsafe(d,h,y){let m=l.BASE,T=(N,U)=>U===Ut||U===dt||!N.equals(m)?N.multiplyUnsafe(U):N.multiply(U),I=T(this,h).add(T(d,y));return I.is0()?void 0:I}toAffine(d){let{px:h,py:y,pz:m}=this,T=this.is0();d==null&&(d=T?n.ONE:n.inv(m));let I=n.mul(h,d),N=n.mul(y,d),U=n.mul(m,d);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(U,n.ONE))throw new Error("invZ was invalid");return{x:I,y:N}}isTorsionFree(){let{h:d,isTorsionFree:h}=t;if(d===dt)return!0;if(h)return h(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:h}=t;return d===dt?this:h?h(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return ne(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);let b=t.nBitLength,g=wo(l,t.endo?Math.ceil(b/2):b);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:s,isWithinCurveOrder:i}}function Pi(e){let t=Yn(e);return Dt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Eo(e){let t=Pi(e),{Fp:n,n:r}=t,o=n.BYTES+1,s=2*n.BYTES+1;function i(x){return Ut<x&&x<n.ORDER}function c(x){return F(x,r)}function f(x){return Fe(x,r)}let{ProjectivePoint:a,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:b}=Ki({...t,toBytes(x,w,A){let S=w.toAffine(),E=n.toBytes(S.x),L=It;return A?L(Uint8Array.from([w.hasEvenY()?2:3]),E):L(Uint8Array.from([4]),E,n.toBytes(S.y))},fromBytes(x){let w=x.length,A=x[0],S=x.subarray(1);if(w===o&&(A===2||A===3)){let E=et(S);if(!i(E))throw new Error("Point is not on curve");let L=l(E),O=n.sqrt(L),_=(O&dt)===dt;return(A&1)===1!==_&&(O=n.neg(O)),{x:E,y:O}}else if(w===s&&A===4){let E=n.fromBytes(S.subarray(0,n.BYTES)),L=n.fromBytes(S.subarray(n.BYTES,2*n.BYTES));return{x:E,y:L}}else throw new Error(`Point of length ${w} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),g=x=>ne(xt(x,t.nByteLength));function p(x){let w=r>>dt;return x>w}function d(x){return p(x)?c(-x):x}let h=(x,w,A)=>et(x.slice(w,A));class y{constructor(w,A,S){this.r=w,this.s=A,this.recovery=S,this.assertValidity()}static fromCompact(w){let A=t.nByteLength;return w=J("compactSignature",w,A*2),new y(h(w,0,A),h(w,A,2*A))}static fromDER(w){let{r:A,s:S}=se.toSig(J("DER",w));return new y(A,S)}assertValidity(){if(!b(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!b(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(w){return new y(this.r,this.s,w)}recoverPublicKey(w){let{r:A,s:S,recovery:E}=this,L=H(J("msgHash",w));if(E==null||![0,1,2,3].includes(E))throw new Error("recovery id invalid");let O=E===2||E===3?A+t.n:A;if(O>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let _=(E&1)===0?"02":"03",j=a.fromHex(_+g(O)),K=f(O),D=c(-L*K),z=c(S*K),G=a.BASE.multiplyAndAddUnsafe(j,D,z);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return re(this.toDERHex())}toDERHex(){return se.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return re(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}let m={isValidPrivateKey(x){try{return u(x),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let x=Wn(t.n);return yo(t.randomBytes(x),t.n)},precompute(x=8,w=a.BASE){return w._setWindowSize(x),w.multiply(BigInt(3)),w}};function T(x,w=!0){return a.fromPrivateKey(x).toRawBytes(w)}function I(x){let w=x instanceof Uint8Array,A=typeof x=="string",S=(w||A)&&x.length;return w?S===o||S===s:A?S===2*o||S===2*s:x instanceof a}function N(x,w,A=!0){if(I(x))throw new Error("first arg must be private key");if(!I(w))throw new Error("second arg must be public key");return a.fromHex(w).multiply(u(x)).toRawBytes(A)}let U=t.bits2int||function(x){let w=et(x),A=x.length*8-t.nBitLength;return A>0?w>>BigInt(A):w},H=t.bits2int_modN||function(x){return c(U(x))},k=Oe(t.nBitLength);function R(x){if(typeof x!="bigint")throw new Error("bigint expected");if(!(Ut<=x&&x<k))throw new Error(`bigint expected < 2^${t.nBitLength}`);return xt(x,t.nByteLength)}function V(x,w,A=$){if(["recovered","canonical"].some(Z=>Z in A))throw new Error("sign() legacy options not supported");let{hash:S,randomBytes:E}=t,{lowS:L,prehash:O,extraEntropy:_}=A;L==null&&(L=!0),x=J("msgHash",x),O&&(x=J("prehashed msgHash",S(x)));let j=H(x),K=u(w),D=[R(K),R(j)];if(_!=null){let Z=_===!0?E(n.BYTES):_;D.push(J("extraEntropy",Z))}let z=It(...D),G=j;function Q(Z){let Y=U(Z);if(!b(Y))return;let ee=f(Y),Tt=a.BASE.multiply(Y).toAffine(),it=c(Tt.x);if(it===Ut)return;let pe=c(ee*c(G+it*K));if(pe===Ut)return;let eo=(Tt.x===it?0:2)|Number(Tt.y&dt),no=pe;return L&&p(pe)&&(no=d(pe),eo^=1),new y(it,no,eo)}return{seed:z,k2sig:Q}}let $={lowS:t.lowS,prehash:!1},q={lowS:t.lowS,prehash:!1};function B(x,w,A=$){let{seed:S,k2sig:E}=V(x,w,A),L=t;return Pn(L.hash.outputLen,L.nByteLength,L.hmac)(S,E)}a.BASE._setWindowSize(8);function v(x,w,A,S=q){var Tt;let E=x;if(w=J("msgHash",w),A=J("publicKey",A),"strict"in S)throw new Error("options.strict was renamed to lowS");let{lowS:L,prehash:O}=S,_,j;try{if(typeof E=="string"||E instanceof Uint8Array)try{_=y.fromDER(E)}catch(it){if(!(it instanceof se.Err))throw it;_=y.fromCompact(E)}else if(typeof E=="object"&&typeof E.r=="bigint"&&typeof E.s=="bigint"){let{r:it,s:pe}=E;_=new y(it,pe)}else throw new Error("PARSE");j=a.fromHex(A)}catch(it){if(it.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&_.hasHighS())return!1;O&&(w=t.hash(w));let{r:K,s:D}=_,z=H(w),G=f(D),Q=c(z*G),Z=c(K*G),Y=(Tt=a.BASE.multiplyAndAddUnsafe(j,Q,Z))==null?void 0:Tt.toAffine();return Y?c(Y.x)===K:!1}return{CURVE:t,getPublicKey:T,getSharedSecret:N,sign:B,verify:v,ProjectivePoint:a,Signature:y,utils:m}}var tn=class extends be{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,so(t);let r=Ue(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return ge(this),this.iHash.update(t),this}digestInto(t){ge(this),$n(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Xn=(e,t,n)=>new tn(e,t).update(n).digest();Xn.create=(e,t)=>new tn(e,t);function Mi(e){return{hash:e,hmac:(t,...n)=>Xn(e,t,fo(...n)),randomBytes:ze}}function Bo(e,t){let n=r=>Eo({...e,...Mi(r)});return Object.freeze({...n(t),create:n})}var on=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),en=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),So=BigInt(1),nn=BigInt(2),vo=(e,t)=>(e+t/nn)/t;function Lo(e){let t=on,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),f=BigInt(88),a=e*e*e%t,u=a*a*e%t,l=at(u,n,t)*u%t,b=at(l,n,t)*u%t,g=at(b,nn,t)*a%t,p=at(g,o,t)*g%t,d=at(p,s,t)*p%t,h=at(d,c,t)*d%t,y=at(h,f,t)*h%t,m=at(y,c,t)*d%t,T=at(m,n,t)*u%t,I=at(T,i,t)*p%t,N=at(I,r,t)*a%t,U=at(N,nn,t);if(!Jn.eql(Jn.sqr(U),e))throw new Error("Cannot find square root");return U}var Jn=bo(on,void 0,void 0,{sqrt:Lo}),Kt=Bo({a:BigInt(0),b:BigInt(7),Fp:Jn,n:en,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=en,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-So*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=vo(s*e,t),f=vo(-r*e,t),a=F(e-c*n-f*o,t),u=F(-c*r-f*s,t),l=a>i,b=u>i;if(l&&(a=t-a),b&&(u=t-u),a>i||u>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:a,k2neg:b,k2:u}}}},Ge),sn=BigInt(0),To=e=>typeof e=="bigint"&&sn<e&&e<on,ji=e=>typeof e=="bigint"&&sn<e&&e<en,Ao={};function rn(e,...t){let n=Ao[e];if(n===void 0){let r=Ge(Uint8Array.from(e,o=>o.charCodeAt(0)));n=It(r,r),Ao[e]=n}return Ge(It(n,...t))}var er=e=>e.toRawBytes(!0).slice(1),Fn=e=>xt(e,32),Qn=e=>F(e,on),_e=e=>F(e,en),nr=Kt.ProjectivePoint,Zi=(e,t,n)=>nr.BASE.multiplyAndAddUnsafe(e,t,n);function tr(e){let t=Kt.utils.normPrivateKeyToScalar(e),n=nr.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:_e(-t),bytes:er(n)}}function Io(e){if(!To(e))throw new Error("bad x: need 0 < x < p");let t=Qn(e*e),n=Qn(t*e+BigInt(7)),r=Lo(n);r%nn!==sn&&(r=Qn(-r));let o=new nr(e,r,So);return o.assertValidity(),o}function Uo(...e){return _e(et(rn("BIP0340/challenge",...e)))}function zi(e){return tr(e).bytes}function Wi(e,t,n=ze(32)){let r=J("message",e),{bytes:o,scalar:s}=tr(t),i=J("auxRand",n,32),c=Fn(s^et(rn("BIP0340/aux",i))),f=rn("BIP0340/nonce",c,o,r),a=_e(et(f));if(a===sn)throw new Error("sign failed: k is zero");let{bytes:u,scalar:l}=tr(a),b=Uo(u,o,r),g=new Uint8Array(64);if(g.set(u,0),g.set(Fn(_e(l+b*s)),32),!Oo(g,r,o))throw new Error("sign: Invalid signature produced");return g}function Oo(e,t,n){let r=J("signature",e,64),o=J("message",t),s=J("publicKey",n,32);try{let i=Io(et(s)),c=et(r.subarray(0,32));if(!To(c))return!1;let f=et(r.subarray(32,64));if(!ji(f))return!1;let a=Uo(Fn(c),er(i),o),u=Zi(i,f,_e(-a));return!(!u||!u.hasEvenY()||u.toAffine().x!==c)}catch{return!1}}var ht={getPublicKey:zi,sign:Wi,verify:Oo,utils:{randomPrivateKey:Kt.utils.randomPrivateKey,lift_x:Io,pointToBytes:er,numberToBytesBE:xt,bytesToNumberBE:et,taggedHash:rn,mod:F}};var cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var rr=e=>e instanceof Uint8Array;var fn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),yt=(e,t)=>e<<32-t|e>>>t,Gi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Gi)throw new Error("Non little-endian hardware is not supported");var Yi=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ct(e){if(!rr(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Yi[e[n]];return t}function _o(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){let o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Xi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Pt(e){if(typeof e=="string"&&(e=Xi(e)),!rr(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function He(...e){let t=new Uint8Array(e.reduce((r,o)=>r+o.length,0)),n=0;return e.forEach(r=>{if(!rr(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var xe=class{clone(){return this._cloneInto()}};function or(e){let t=r=>e().update(Pt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function an(e=32){if(cn&&typeof cn.getRandomValues=="function")return cn.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function sr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Qi(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Ho(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ji(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");sr(e.outputLen),sr(e.blockLen)}function Fi(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function tc(e,t){Ho(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var ec={number:sr,bool:Qi,bytes:Ho,hash:Ji,exists:Fi,output:tc},ut=ec;function nc(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),f=r?4:0,a=r?0:4;e.setUint32(t+f,i,r),e.setUint32(t+a,c,r)}var un=class extends xe{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=fn(this.buffer)}update(t){ut.exists(this);let{view:n,buffer:r,blockLen:o}=this;t=Pt(t);let s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let f=fn(t);for(;o<=s-i;i+=o)this.process(f,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ut.exists(this),ut.output(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;nc(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=fn(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let a=f/4,u=this.get();if(a>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<a;l++)c.setUint32(4*l,u[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};var rc=(e,t,n)=>e&t^~e&n,oc=(e,t,n)=>e&t^e&n^t&n,sc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),jt=new Uint32Array(64),ln=class extends un{constructor(){super(64,32,8,!1),this.A=Mt[0]|0,this.B=Mt[1]|0,this.C=Mt[2]|0,this.D=Mt[3]|0,this.E=Mt[4]|0,this.F=Mt[5]|0,this.G=Mt[6]|0,this.H=Mt[7]|0}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:f}=this;return[t,n,r,o,s,i,c,f]}set(t,n,r,o,s,i,c,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=f|0}process(t,n){for(let l=0;l<16;l++,n+=4)jt[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let b=jt[l-15],g=jt[l-2],p=yt(b,7)^yt(b,18)^b>>>3,d=yt(g,17)^yt(g,19)^g>>>10;jt[l]=d+jt[l-7]+p+jt[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:f,G:a,H:u}=this;for(let l=0;l<64;l++){let b=yt(c,6)^yt(c,11)^yt(c,25),g=u+b+rc(c,f,a)+sc[l]+jt[l]|0,d=(yt(r,2)^yt(r,13)^yt(r,22))+oc(r,o,s)|0;u=a,a=f,f=c,c=i+g|0,i=s,s=o,o=r,r=g+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,f=f+this.F|0,a=a+this.G|0,u=u+this.H|0,this.set(r,o,s,i,c,f,a,u)}roundClean(){jt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},ir=class extends ln{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Zt=or(()=>new ln),qa=or(()=>new ir);var ye=Symbol("verified"),ic=e=>e instanceof Object;function cc(e){if(!ic(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var ja=new TextDecoder("utf-8"),fc=new TextEncoder,ac=class{generateSecretKey(){return ht.utils.randomPrivateKey()}getPublicKey(e){return ct(ht.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=ct(ht.getPublicKey(t)),n.id=cr(n),n.sig=ct(ht.sign(cr(n),t)),n[ye]=!0,n}verifyEvent(e){if(typeof e[ye]=="boolean")return e[ye];let t=cr(e);if(t!==e.id)return e[ye]=!1,!1;try{let n=ht.verify(e.sig,t,e.pubkey);return e[ye]=n,n}catch{return e[ye]=!1,!1}}};function uc(e){if(!cc(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function cr(e){let t=Zt(fc.encode(uc(e)));return ct(t)}var dn=new ac,Za=dn.generateSecretKey,Ro=dn.getPublicKey,za=dn.finalizeEvent,Wa=dn.verifyEvent;function Re(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function wt(e,t=""){if(!Number.isSafeInteger(e)||e<0){let n=t&&`"${t}" `;throw new Error(`${n}expected integer >= 0, got ${e}`)}}function W(e,t,n=""){let r=Re(e),o=e==null?void 0:e.length,s=t!==void 0;if(!r||s&&o!==t){let i=n&&`"${n}" `,c=s?` of length ${t}`:"",f=r?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+f)}return e}function we(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");wt(e.outputLen),wt(e.blockLen)}function me(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ko(e,t){W(e,void 0,"digestInto() output");let n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function zt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function hn(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function mt(e,t){return e<<32-t|e>>>t}var qo=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ie(e){if(W(e),qo)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=lc[e[n]];return t}var Ot={_0:48,_9:57,A:65,F:70,a:97,f:102};function No(e){if(e>=Ot._0&&e<=Ot._9)return e-Ot._0;if(e>=Ot.A&&e<=Ot.F)return e-(Ot.A-10);if(e>=Ot.a&&e<=Ot.f)return e-(Ot.a-10)}function ce(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(qo)return Uint8Array.fromHex(e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let i=No(e.charCodeAt(s)),c=No(e.charCodeAt(s+1));if(i===void 0||c===void 0){let f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[o]=i*16+c}return r}function ft(...e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];W(o),t+=o.length}let n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){let s=e[r];n.set(s,o),o+=s.length}return n}function Co(e,t={}){let n=(o,s)=>e(s).update(o).digest(),r=e(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=o=>e(o),Object.assign(n,t),Object.freeze(n)}function fe(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof(t==null?void 0:t.getRandomValues)!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var $o=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function Vo(e,t,n){return e&t^~e&n}function Do(e,t,n){return e&t^e&n^t&n}var pn=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,n,r,o){this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(t),this.view=hn(this.buffer)}update(t){me(this),W(t);let{view:n,buffer:r,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let f=hn(t);for(;o<=s-i;i+=o)this.process(f,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){me(this),ko(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,zt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;r.setBigUint64(o-8,BigInt(this.length*8),s),this.process(r,0);let c=hn(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let a=f/4,u=this.get();if(a>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<a;l++)c.setUint32(4*l,u[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}},_t=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var dc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wt=new Uint32Array(64),fr=class extends pn{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:f}=this;return[t,n,r,o,s,i,c,f]}set(t,n,r,o,s,i,c,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=f|0}process(t,n){for(let l=0;l<16;l++,n+=4)Wt[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let b=Wt[l-15],g=Wt[l-2],p=mt(b,7)^mt(b,18)^b>>>3,d=mt(g,17)^mt(g,19)^g>>>10;Wt[l]=d+Wt[l-7]+p+Wt[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:f,G:a,H:u}=this;for(let l=0;l<64;l++){let b=mt(c,6)^mt(c,11)^mt(c,25),g=u+b+Vo(c,f,a)+dc[l]+Wt[l]|0,d=(mt(r,2)^mt(r,13)^mt(r,22))+Do(r,o,s)|0;u=a,a=f,f=c,c=i+g|0,i=s,s=o,o=r,r=g+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,f=f+this.F|0,a=a+this.G|0,u=u+this.H|0,this.set(r,o,s,i,c,f,a,u)}roundClean(){zt(Wt)}destroy(){this.set(0,0,0,0,0,0,0,0),zt(this.buffer)}},ar=class extends fr{A=_t[0]|0;B=_t[1]|0;C=_t[2]|0;D=_t[3]|0;E=_t[4]|0;F=_t[5]|0;G=_t[6]|0;H=_t[7]|0;constructor(){super(32)}};var Et=Co(()=>new ar,$o(1));var lr=BigInt(0),ur=BigInt(1);function Ne(e,t=""){if(typeof e!="boolean"){let n=t&&`"${t}" `;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function Ko(e){if(typeof e=="bigint"){if(!gn(e))throw new Error("positive bigint expected, got "+e)}else wt(e);return e}function ke(e){let t=Ko(e).toString(16);return t.length&1?"0"+t:t}function Po(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?lr:BigInt("0x"+e)}function Gt(e){return Po(ie(e))}function dr(e){return Po(ie(hc(W(e)).reverse()))}function bn(e,t){wt(t),e=Ko(e);let n=ce(e.toString(16).padStart(t*2,"0"));if(n.length!==t)throw new Error("number too large");return n}function hr(e,t){return bn(e,t).reverse()}function hc(e){return Uint8Array.from(e)}function Mo(e){return Uint8Array.from(e,(t,n)=>{let r=t.charCodeAt(0);if(t.length!==1||r>127)throw new Error(`string contains non-ASCII character "${e[n]}" with code ${r} at position ${n}`);return r})}var gn=e=>typeof e=="bigint"&&lr<=e;function pc(e,t,n){return gn(e)&&gn(t)&&gn(n)&&t<=e&&e<n}function jo(e,t,n,r){if(!pc(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function pr(e){let t;for(t=0;e>lr;e>>=ur,t+=1);return t}var qe=e=>(ur<<BigInt(e))-ur;function Zo(e,t,n){if(wt(e,"hashLen"),wt(t,"qByteLen"),typeof n!="function")throw new Error("hmacFn must be a function");let r=h=>new Uint8Array(h),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),c=1e3,f=r(e),a=r(e),u=0,l=()=>{f.fill(1),a.fill(0),u=0},b=(...h)=>n(a,ft(f,...h)),g=(h=o)=>{a=b(s,h),f=b(),h.length!==0&&(a=b(i,h),f=b())},p=()=>{if(u++>=c)throw new Error("drbg: tried max amount of iterations");let h=0,y=[];for(;h<t;){f=b();let m=f.slice();y.push(m),h+=f.length}return ft(...y)};return(h,y)=>{l(),g(h);let m;for(;!(m=y(p()));)g();return l(),m}}function Ce(e,t={},n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(s,i,c){let f=e[s];if(c&&f===void 0)return;let a=typeof f;if(a!==i||f===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${a}`)}let o=(s,i)=>Object.entries(s).forEach(([c,f])=>r(c,f,i));o(t,!1),o(n,!0)}function gr(e){let t=new WeakMap;return(n,...r)=>{let o=t.get(n);if(o!==void 0)return o;let s=e(n,...r);return t.set(n,s),s}}var ot=BigInt(0),rt=BigInt(1),ae=BigInt(2),Go=BigInt(3),Yo=BigInt(4),Xo=BigInt(5),gc=BigInt(7),Qo=BigInt(8),bc=BigInt(9),Jo=BigInt(16);function Bt(e,t){let n=e%t;return n>=ot?n:t+n}function lt(e,t,n){let r=e;for(;t-- >ot;)r*=r,r%=n;return r}function zo(e,t){if(e===ot)throw new Error("invert: expected non-zero number");if(t<=ot)throw new Error("invert: expected positive modulus, got "+t);let n=Bt(e,t),r=t,o=ot,s=rt,i=rt,c=ot;for(;n!==ot;){let a=r/n,u=r%n,l=o-i*a,b=s-c*a;r=n,n=u,o=i,s=c,i=l,c=b}if(r!==rt)throw new Error("invert: does not exist");return Bt(o,t)}function xr(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function Fo(e,t){let n=(e.ORDER+rt)/Yo,r=e.pow(t,n);return xr(e,r,t),r}function xc(e,t){let n=(e.ORDER-Xo)/Qo,r=e.mul(t,ae),o=e.pow(r,n),s=e.mul(t,o),i=e.mul(e.mul(s,ae),o),c=e.mul(s,e.sub(i,e.ONE));return xr(e,c,t),c}function yc(e){let t=Ee(e),n=ts(e),r=n(t,t.neg(t.ONE)),o=n(t,r),s=n(t,t.neg(r)),i=(e+gc)/Jo;return(c,f)=>{let a=c.pow(f,i),u=c.mul(a,r),l=c.mul(a,o),b=c.mul(a,s),g=c.eql(c.sqr(u),f),p=c.eql(c.sqr(l),f);a=c.cmov(a,u,g),u=c.cmov(b,l,p);let d=c.eql(c.sqr(u),f),h=c.cmov(a,u,d);return xr(c,h,f),h}}function ts(e){if(e<Go)throw new Error("sqrt is not defined for small field");let t=e-rt,n=0;for(;t%ae===ot;)t/=ae,n++;let r=ae,o=Ee(e);for(;Wo(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Fo;let s=o.pow(r,t),i=(t+rt)/ae;return function(f,a){if(f.is0(a))return a;if(Wo(f,a)!==1)throw new Error("Cannot find square root");let u=n,l=f.mul(f.ONE,s),b=f.pow(a,t),g=f.pow(a,i);for(;!f.eql(b,f.ONE);){if(f.is0(b))return f.ZERO;let p=1,d=f.sqr(b);for(;!f.eql(d,f.ONE);)if(p++,d=f.sqr(d),p===u)throw new Error("Cannot find square root");let h=rt<<BigInt(u-p-1),y=f.pow(l,h);u=p,l=f.sqr(y),b=f.mul(b,l),g=f.mul(g,y)}return g}}function wc(e){return e%Yo===Go?Fo:e%Qo===Xo?xc:e%Jo===bc?yc(e):ts(e)}var mc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yr(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},n=mc.reduce((r,o)=>(r[o]="function",r),t);return Ce(e,n),e}function Ec(e,t,n){if(n<ot)throw new Error("invalid exponent, negatives unsupported");if(n===ot)return e.ONE;if(n===rt)return t;let r=e.ONE,o=t;for(;n>ot;)n&rt&&(r=e.mul(r,o)),o=e.sqr(o),n>>=rt;return r}function xn(e,t,n=!1){let r=new Array(t.length).fill(n?e.ZERO:void 0),o=t.reduce((i,c,f)=>e.is0(c)?i:(r[f]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,f)=>e.is0(c)?i:(r[f]=e.mul(i,r[f]),e.mul(i,c)),s),r}function Wo(e,t){let n=(e.ORDER-rt)/ae,r=e.pow(t,n),o=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),i=e.eql(r,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Bc(e,t){t!==void 0&&wt(t);let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}var br=class{ORDER;BITS;BYTES;isLE;ZERO=ot;ONE=rt;_lengths;_sqrt;_mod;constructor(t,n={}){var i;if(t<=ot)throw new Error("invalid field: expected ORDER > 0, got "+t);let r;this.isLE=!1,n!=null&&typeof n=="object"&&(typeof n.BITS=="number"&&(r=n.BITS),typeof n.sqrt=="function"&&(this.sqrt=n.sqrt),typeof n.isLE=="boolean"&&(this.isLE=n.isLE),n.allowedLengths&&(this._lengths=(i=n.allowedLengths)==null?void 0:i.slice()),typeof n.modFromBytes=="boolean"&&(this._mod=n.modFromBytes));let{nBitLength:o,nByteLength:s}=Bc(t,r);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return Bt(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return ot<=t&&t<this.ORDER}is0(t){return t===ot}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&rt)===rt}neg(t){return Bt(-t,this.ORDER)}eql(t,n){return t===n}sqr(t){return Bt(t*t,this.ORDER)}add(t,n){return Bt(t+n,this.ORDER)}sub(t,n){return Bt(t-n,this.ORDER)}mul(t,n){return Bt(t*n,this.ORDER)}pow(t,n){return Ec(this,t,n)}div(t,n){return Bt(t*zo(n,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,n){return t+n}subN(t,n){return t-n}mulN(t,n){return t*n}inv(t){return zo(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=wc(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?hr(t,this.BYTES):bn(t,this.BYTES)}fromBytes(t,n=!1){W(t);let{_lengths:r,BYTES:o,isLE:s,ORDER:i,_mod:c}=this;if(r){if(!r.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+t.length);let a=new Uint8Array(o);a.set(t,s?0:a.length-t.length),t=a}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let f=s?dr(t):Gt(t);if(c&&(f=Bt(f,i)),!n&&!this.isValid(f))throw new Error("invalid field element: outside of range 0..ORDER");return f}invertBatch(t){return xn(this,t)}cmov(t,n,r){return r?n:t}};function Ee(e,t={}){return new br(e,t)}function es(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function wr(e){let t=es(e);return t+Math.ceil(t/2)}function yn(e,t,n=!1){W(e);let r=e.length,o=es(t),s=wr(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);let i=n?dr(e):Gt(e),c=Bt(i,t-rt)+rt;return n?hr(c,o):bn(c,o)}var Be=BigInt(0),ue=BigInt(1);function $e(e,t){let n=t.negate();return e?n:t}function vr(e,t){let n=xn(e.Fp,t.map(r=>r.Z));return t.map((r,o)=>e.fromAffine(r.toAffine(n[o])))}function ss(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function mr(e,t){ss(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),o=2**e,s=qe(e),i=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:i}}function ns(e,t,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:i}=n,c=Number(e&o),f=e>>i;c>r&&(c-=s,f+=ue);let a=t*r,u=a+Math.abs(c)-1,l=c===0,b=c<0,g=t%2!==0;return{nextN:f,offset:u,isZero:l,isNeg:b,isNegF:g,offsetF:a}}var Er=new WeakMap,is=new WeakMap;function Br(e){return is.get(e)||1}function rs(e){if(e!==Be)throw new Error("invalid wNAF")}var wn=class{BASE;ZERO;Fn;bits;constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let o=t;for(;n>Be;)n&ue&&(r=r.add(o)),o=o.double(),n>>=ue;return r}precomputeWindow(t,n){let{windows:r,windowSize:o}=mr(n,this.bits),s=[],i=t,c=i;for(let f=0;f<r;f++){c=i,s.push(c);for(let a=1;a<o;a++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=mr(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:f,offset:a,isZero:u,isNeg:l,isNegF:b,offsetF:g}=ns(r,c,i);r=f,u?s=s.add($e(b,n[g])):o=o.add($e(l,n[a]))}return rs(r),{p:o,f:s}}wNAFUnsafe(t,n,r,o=this.ZERO){let s=mr(t,this.bits);for(let i=0;i<s.windows&&r!==Be;i++){let{nextN:c,offset:f,isZero:a,isNeg:u}=ns(r,i,s);if(r=c,!a){let l=n[f];o=o.add(u?l.negate():l)}}return rs(r),o}getPrecomputes(t,n,r){let o=Er.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(o=r(o)),Er.set(n,o))),o}cached(t,n,r){let o=Br(t);return this.wNAF(o,this.getPrecomputes(o,t,r),n)}unsafe(t,n,r,o){let s=Br(t);return s===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,o)}createCache(t,n){ss(n,this.bits),is.set(t,n),Er.delete(t)}hasCache(t){return Br(t)!==1}};function cs(e,t,n,r){let o=t,s=e.ZERO,i=e.ZERO;for(;n>Be||r>Be;)n&ue&&(s=s.add(o)),r&ue&&(i=i.add(o)),o=o.double(),n>>=ue,r>>=ue;return{p1:s,p2:i}}function os(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return yr(t),t}else return Ee(e,{isLE:n})}function fs(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let f of["p","n","h"]){let a=t[f];if(!(typeof a=="bigint"&&a>Be))throw new Error(`CURVE.${f} must be positive bigint`)}let o=os(t.p,n.Fp,r),s=os(t.n,n.Fn,r),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let f of c)if(!o.isValid(t[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function mn(e,t){return function(r){let o=e(r);return{secretKey:o,publicKey:t(o)}}}var En=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,n){if(we(t),W(n,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?t.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),zt(o)}update(t){return me(this),this.iHash.update(t),this}digestInto(t){me(this),W(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ve=(e,t,n)=>new En(e,t).update(n).digest();Ve.create=(e,t)=>new En(e,t);var as=(e,t)=>(e+(e>=0?t:-t)/us)/t;function vc(e,t,n){let[[r,o],[s,i]]=t,c=as(i*e,n),f=as(-o*e,n),a=e-c*r-f*s,u=-c*o-f*i,l=a<Ht,b=u<Ht;l&&(a=-a),b&&(u=-u);let g=qe(Math.ceil(pr(n)/2))+ve;if(a<Ht||a>=g||u<Ht||u>=g)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:l,k1:a,k2neg:b,k2:u}}function Sr(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Ar(e,t){let n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return Ne(n.lowS,"lowS"),Ne(n.prehash,"prehash"),n.format!==void 0&&Sr(n.format),n}var Lr=class extends Error{constructor(t=""){super(t)}},Yt={Err:Lr,_tlv:{encode:(e,t)=>{let{Err:n}=Yt;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");let r=t.length/2,o=ke(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");let s=r>127?ke(o.length/2|128):"";return ke(e)+s+o+t},decode(e,t){let{Err:n}=Yt,r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");let o=t[r++],s=!!(o&128),i=0;if(!s)i=o;else{let f=o&127;if(!f)throw new n("tlv.decode(long): indefinite length not supported");if(f>4)throw new n("tlv.decode(long): byte length is too big");let a=t.subarray(r,r+f);if(a.length!==f)throw new n("tlv.decode: length bytes not complete");if(a[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(let u of a)i=i<<8|u;if(r+=f,i<128)throw new n("tlv.decode(long): not minimal encoding")}let c=t.subarray(r,r+i);if(c.length!==i)throw new n("tlv.decode: wrong value length");return{v:c,l:t.subarray(r+i)}}},_int:{encode(e){let{Err:t}=Yt;if(e<Ht)throw new t("integer: negative integers are not allowed");let n=ke(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){let{Err:t}=Yt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Gt(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=Yt,o=W(e,void 0,"signature"),{v:s,l:i}=r.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:f}=r.decode(2,s),{v:a,l:u}=r.decode(2,f);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(c),s:n.decode(a)}},hexFromSig(e){let{_tlv:t,_int:n}=Yt,r=t.encode(2,n.encode(e.r)),o=t.encode(2,n.encode(e.s)),s=r+o;return t.encode(48,s)}},Ht=BigInt(0),ve=BigInt(1),us=BigInt(2),Bn=BigInt(3),Ac=BigInt(4);function ls(e,t={}){let n=fs("weierstrass",e,t),{Fp:r,Fn:o}=n,s=n.CURVE,{h:i,n:c}=s;Ce(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:f}=t;if(f&&(!r.is0(s.a)||typeof f.beta!="bigint"||!Array.isArray(f.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let a=hs(r,o);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(q,B,v){let{x,y:w}=B.toAffine(),A=r.toBytes(x);if(Ne(v,"isCompressed"),v){u();let S=!r.isOdd(w);return ft(ds(S),A)}else return ft(Uint8Array.of(4),A,r.toBytes(w))}function b(q){W(q,void 0,"Point");let{publicKey:B,publicKeyUncompressed:v}=a,x=q.length,w=q[0],A=q.subarray(1);if(x===B&&(w===2||w===3)){let S=r.fromBytes(A);if(!r.isValid(S))throw new Error("bad point: is not on curve, wrong x");let E=d(S),L;try{L=r.sqrt(E)}catch(j){let K=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}u();let O=r.isOdd(L);return(w&1)===1!==O&&(L=r.neg(L)),{x:S,y:L}}else if(x===v&&w===4){let S=r.BYTES,E=r.fromBytes(A.subarray(0,S)),L=r.fromBytes(A.subarray(S,S*2));if(!h(E,L))throw new Error("bad point: is not on curve");return{x:E,y:L}}else throw new Error(`bad point: got length ${x}, expected compressed=${B} or uncompressed=${v}`)}let g=t.toBytes||l,p=t.fromBytes||b;function d(q){let B=r.sqr(q),v=r.mul(B,q);return r.add(r.add(v,r.mul(q,s.a)),s.b)}function h(q,B){let v=r.sqr(B),x=d(q);return r.eql(v,x)}if(!h(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=r.mul(r.pow(s.a,Bn),Ac),m=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(y,m)))throw new Error("bad curve params: a or b");function T(q,B,v=!1){if(!r.isValid(B)||v&&r.is0(B))throw new Error(`bad point coordinate ${q}`);return B}function I(q){if(!(q instanceof R))throw new Error("Weierstrass Point expected")}function N(q){if(!f||!f.basises)throw new Error("no endo");return vc(q,f.basises,o.ORDER)}let U=gr((q,B)=>{let{X:v,Y:x,Z:w}=q;if(r.eql(w,r.ONE))return{x:v,y:x};let A=q.is0();B==null&&(B=A?r.ONE:r.inv(w));let S=r.mul(v,B),E=r.mul(x,B),L=r.mul(w,B);if(A)return{x:r.ZERO,y:r.ZERO};if(!r.eql(L,r.ONE))throw new Error("invZ was invalid");return{x:S,y:E}}),H=gr(q=>{if(q.is0()){if(t.allowInfinityPoint&&!r.is0(q.Y))return;throw new Error("bad point: ZERO")}let{x:B,y:v}=q.toAffine();if(!r.isValid(B)||!r.isValid(v))throw new Error("bad point: x or y not field elements");if(!h(B,v))throw new Error("bad point: equation left != right");if(!q.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function k(q,B,v,x,w){return v=new R(r.mul(v.X,q),v.Y,v.Z),B=$e(x,B),v=$e(w,v),B.add(v)}class R{static BASE=new R(s.Gx,s.Gy,r.ONE);static ZERO=new R(r.ZERO,r.ONE,r.ZERO);static Fp=r;static Fn=o;X;Y;Z;constructor(B,v,x){this.X=T("x",B),this.Y=T("y",v,!0),this.Z=T("z",x),Object.freeze(this)}static CURVE(){return s}static fromAffine(B){let{x:v,y:x}=B||{};if(!B||!r.isValid(v)||!r.isValid(x))throw new Error("invalid affine point");if(B instanceof R)throw new Error("projective point not allowed");return r.is0(v)&&r.is0(x)?R.ZERO:new R(v,x,r.ONE)}static fromBytes(B){let v=R.fromAffine(p(W(B,void 0,"point")));return v.assertValidity(),v}static fromHex(B){return R.fromBytes(ce(B))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,v=!0){return $.createCache(this,B),v||this.multiply(Bn),this}assertValidity(){H(this)}hasEvenY(){let{y:B}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(B)}equals(B){I(B);let{X:v,Y:x,Z:w}=this,{X:A,Y:S,Z:E}=B,L=r.eql(r.mul(v,E),r.mul(A,w)),O=r.eql(r.mul(x,E),r.mul(S,w));return L&&O}negate(){return new R(this.X,r.neg(this.Y),this.Z)}double(){let{a:B,b:v}=s,x=r.mul(v,Bn),{X:w,Y:A,Z:S}=this,E=r.ZERO,L=r.ZERO,O=r.ZERO,_=r.mul(w,w),j=r.mul(A,A),K=r.mul(S,S),D=r.mul(w,A);return D=r.add(D,D),O=r.mul(w,S),O=r.add(O,O),E=r.mul(B,O),L=r.mul(x,K),L=r.add(E,L),E=r.sub(j,L),L=r.add(j,L),L=r.mul(E,L),E=r.mul(D,E),O=r.mul(x,O),K=r.mul(B,K),D=r.sub(_,K),D=r.mul(B,D),D=r.add(D,O),O=r.add(_,_),_=r.add(O,_),_=r.add(_,K),_=r.mul(_,D),L=r.add(L,_),K=r.mul(A,S),K=r.add(K,K),_=r.mul(K,D),E=r.sub(E,_),O=r.mul(K,j),O=r.add(O,O),O=r.add(O,O),new R(E,L,O)}add(B){I(B);let{X:v,Y:x,Z:w}=this,{X:A,Y:S,Z:E}=B,L=r.ZERO,O=r.ZERO,_=r.ZERO,j=s.a,K=r.mul(s.b,Bn),D=r.mul(v,A),z=r.mul(x,S),G=r.mul(w,E),Q=r.add(v,x),Z=r.add(A,S);Q=r.mul(Q,Z),Z=r.add(D,z),Q=r.sub(Q,Z),Z=r.add(v,w);let Y=r.add(A,E);return Z=r.mul(Z,Y),Y=r.add(D,G),Z=r.sub(Z,Y),Y=r.add(x,w),L=r.add(S,E),Y=r.mul(Y,L),L=r.add(z,G),Y=r.sub(Y,L),_=r.mul(j,Z),L=r.mul(K,G),_=r.add(L,_),L=r.sub(z,_),_=r.add(z,_),O=r.mul(L,_),z=r.add(D,D),z=r.add(z,D),G=r.mul(j,G),Z=r.mul(K,Z),z=r.add(z,G),G=r.sub(D,G),G=r.mul(j,G),Z=r.add(Z,G),D=r.mul(z,Z),O=r.add(O,D),D=r.mul(Y,Z),L=r.mul(Q,L),L=r.sub(L,D),D=r.mul(Q,z),_=r.mul(Y,_),_=r.add(_,D),new R(L,O,_)}subtract(B){return this.add(B.negate())}is0(){return this.equals(R.ZERO)}multiply(B){let{endo:v}=t;if(!o.isValidNot0(B))throw new Error("invalid scalar: out of range");let x,w,A=S=>$.cached(this,S,E=>vr(R,E));if(v){let{k1neg:S,k1:E,k2neg:L,k2:O}=N(B),{p:_,f:j}=A(E),{p:K,f:D}=A(O);w=j.add(D),x=k(v.beta,_,K,S,L)}else{let{p:S,f:E}=A(B);x=S,w=E}return vr(R,[x,w])[0]}multiplyUnsafe(B){let{endo:v}=t,x=this;if(!o.isValid(B))throw new Error("invalid scalar: out of range");if(B===Ht||x.is0())return R.ZERO;if(B===ve)return x;if($.hasCache(this))return this.multiply(B);if(v){let{k1neg:w,k1:A,k2neg:S,k2:E}=N(B),{p1:L,p2:O}=cs(R,x,A,E);return k(v.beta,L,O,w,S)}else return $.unsafe(x,B)}toAffine(B){return U(this,B)}isTorsionFree(){let{isTorsionFree:B}=t;return i===ve?!0:B?B(R,this):$.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:B}=t;return i===ve?this:B?B(R,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(B=!0){return Ne(B,"isCompressed"),this.assertValidity(),g(R,this,B)}toHex(B=!0){return ie(this.toBytes(B))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let V=o.BITS,$=new wn(R,t.endo?Math.ceil(V/2):V);return R.BASE.precompute(8),R}function ds(e){return Uint8Array.of(e?2:3)}function hs(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function Sc(e,t={}){let{Fn:n}=e,r=t.randomBytes||fe,o=Object.assign(hs(e.Fp,n),{seed:wr(n.ORDER)});function s(g){try{let p=n.fromBytes(g);return n.isValidNot0(p)}catch{return!1}}function i(g,p){let{publicKey:d,publicKeyUncompressed:h}=o;try{let y=g.length;return p===!0&&y!==d||p===!1&&y!==h?!1:!!e.fromBytes(g)}catch{return!1}}function c(g=r(o.seed)){return yn(W(g,o.seed,"seed"),n.ORDER)}function f(g,p=!0){return e.BASE.multiply(n.fromBytes(g)).toBytes(p)}function a(g){let{secretKey:p,publicKey:d,publicKeyUncompressed:h}=o;if(!Re(g)||"_lengths"in n&&n._lengths||p===d)return;let y=W(g,void 0,"key").length;return y===d||y===h}function u(g,p,d=!0){if(a(g)===!0)throw new Error("first arg must be private key");if(a(p)===!1)throw new Error("second arg must be public key");let h=n.fromBytes(g);return e.fromBytes(p).multiply(h).toBytes(d)}let l={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c},b=mn(c,f);return Object.freeze({getPublicKey:f,getSharedSecret:u,keygen:b,Point:e,utils:l,lengths:o})}function ps(e,t,n={}){we(t),Ce(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),n=Object.assign({},n);let r=n.randomBytes||fe,o=n.hmac||((v,x)=>Ve(t,v,x)),{Fp:s,Fn:i}=e,{ORDER:c,BITS:f}=i,{keygen:a,getPublicKey:u,getSharedSecret:l,utils:b,lengths:g}=Sc(e,n),p={prehash:!0,lowS:typeof n.lowS=="boolean"?n.lowS:!0,format:"compact",extraEntropy:!1},d=c*us<s.ORDER;function h(v){let x=c>>ve;return v>x}function y(v,x){if(!i.isValidNot0(x))throw new Error(`invalid signature ${v}: out of range 1..Point.Fn.ORDER`);return x}function m(){if(d)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function T(v,x){Sr(x);let w=g.signature,A=x==="compact"?w:x==="recovered"?w+1:void 0;return W(v,A)}class I{r;s;recovery;constructor(x,w,A){if(this.r=y("r",x),this.s=y("s",w),A!=null){if(m(),![0,1,2,3].includes(A))throw new Error("invalid recovery id");this.recovery=A}Object.freeze(this)}static fromBytes(x,w=p.format){T(x,w);let A;if(w==="der"){let{r:O,s:_}=Yt.toSig(W(x));return new I(O,_)}w==="recovered"&&(A=x[0],w="compact",x=x.subarray(1));let S=g.signature/2,E=x.subarray(0,S),L=x.subarray(S,S*2);return new I(i.fromBytes(E),i.fromBytes(L),A)}static fromHex(x,w){return this.fromBytes(ce(x),w)}assertRecovery(){let{recovery:x}=this;if(x==null)throw new Error("invalid recovery id: must be present");return x}addRecoveryBit(x){return new I(this.r,this.s,x)}recoverPublicKey(x){let{r:w,s:A}=this,S=this.assertRecovery(),E=S===2||S===3?w+c:w;if(!s.isValid(E))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let L=s.toBytes(E),O=e.fromBytes(ft(ds((S&1)===0),L)),_=i.inv(E),j=U(W(x,void 0,"msgHash")),K=i.create(-j*_),D=i.create(A*_),z=e.BASE.multiplyUnsafe(K).add(O.multiplyUnsafe(D));if(z.is0())throw new Error("invalid recovery: point at infinify");return z.assertValidity(),z}hasHighS(){return h(this.s)}toBytes(x=p.format){if(Sr(x),x==="der")return ce(Yt.hexFromSig(this));let{r:w,s:A}=this,S=i.toBytes(w),E=i.toBytes(A);return x==="recovered"?(m(),ft(Uint8Array.of(this.assertRecovery()),S,E)):ft(S,E)}toHex(x){return ie(this.toBytes(x))}}let N=n.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");let w=Gt(x),A=x.length*8-f;return A>0?w>>BigInt(A):w},U=n.bits2int_modN||function(x){return i.create(N(x))},H=qe(f);function k(v){return jo("num < 2^"+f,v,Ht,H),i.toBytes(v)}function R(v,x){return W(v,void 0,"message"),x?W(t(v),void 0,"prehashed message"):v}function V(v,x,w){let{lowS:A,prehash:S,extraEntropy:E}=Ar(w,p);v=R(v,S);let L=U(v),O=i.fromBytes(x);if(!i.isValidNot0(O))throw new Error("invalid private key");let _=[k(O),k(L)];if(E!=null&&E!==!1){let z=E===!0?r(g.secretKey):E;_.push(W(z,void 0,"extraEntropy"))}let j=ft(..._),K=L;function D(z){let G=N(z);if(!i.isValidNot0(G))return;let Q=i.inv(G),Z=e.BASE.multiply(G).toAffine(),Y=i.create(Z.x);if(Y===Ht)return;let ee=i.create(Q*i.create(K+Y*O));if(ee===Ht)return;let Tt=(Z.x===Y?0:2)|Number(Z.y&ve),it=ee;return A&&h(ee)&&(it=i.neg(ee),Tt^=1),new I(Y,it,d?void 0:Tt)}return{seed:j,k2sig:D}}function $(v,x,w={}){let{seed:A,k2sig:S}=V(v,x,w);return Zo(t.outputLen,i.BYTES,o)(A,S).toBytes(w.format)}function q(v,x,w,A={}){let{lowS:S,prehash:E,format:L}=Ar(A,p);if(w=W(w,void 0,"publicKey"),x=R(x,E),!Re(v)){let O=v instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+O)}T(v,L);try{let O=I.fromBytes(v,L),_=e.fromBytes(w);if(S&&O.hasHighS())return!1;let{r:j,s:K}=O,D=U(x),z=i.inv(K),G=i.create(D*z),Q=i.create(j*z),Z=e.BASE.multiplyUnsafe(G).add(_.multiplyUnsafe(Q));return Z.is0()?!1:i.create(Z.x)===j}catch{return!1}}function B(v,x,w={}){let{prehash:A}=Ar(w,p);return x=R(x,A),I.fromBytes(v,"recovered").recoverPublicKey(x).toBytes()}return Object.freeze({keygen:a,getPublicKey:u,getSharedSecret:l,utils:b,lengths:g,Point:e,sign:$,verify:q,recoverPublicKey:B,Signature:I,hash:t})}var Sn={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Lc={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},Tc=BigInt(0),Tr=BigInt(2);function Ic(e){let t=Sn.p,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),f=BigInt(88),a=e*e*e%t,u=a*a*e%t,l=lt(u,n,t)*u%t,b=lt(l,n,t)*u%t,g=lt(b,Tr,t)*a%t,p=lt(g,o,t)*g%t,d=lt(p,s,t)*p%t,h=lt(d,c,t)*d%t,y=lt(h,f,t)*h%t,m=lt(y,c,t)*d%t,T=lt(m,n,t)*u%t,I=lt(T,i,t)*p%t,N=lt(I,r,t)*a%t,U=lt(N,Tr,t);if(!vn.eql(vn.sqr(U),e))throw new Error("Cannot find square root");return U}var vn=Ee(Sn.p,{sqrt:Ic}),le=ls(Sn,{Fp:vn,endo:Lc}),xs=ps(le,Et),gs={};function An(e,...t){let n=gs[e];if(n===void 0){let r=Et(Mo(e));n=ft(r,r),gs[e]=n}return Et(ft(n,...t))}var Ur=e=>e.toBytes(!0).slice(1),Or=e=>e%Tr===Tc;function Ir(e){let{Fn:t,BASE:n}=le,r=t.fromBytes(e),o=n.multiply(r);return{scalar:Or(o.y)?r:t.neg(r),bytes:Ur(o)}}function ys(e){let t=vn;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x \u2265 p");let n=t.create(e*e),r=t.create(n*e+BigInt(7)),o=t.sqrt(r);Or(o)||(o=t.neg(o));let s=le.fromAffine({x:e,y:o});return s.assertValidity(),s}var De=Gt;function ws(...e){return le.Fn.create(De(An("BIP0340/challenge",...e)))}function bs(e){return Ir(e).bytes}function Uc(e,t,n=fe(32)){let{Fn:r}=le,o=W(e,void 0,"message"),{bytes:s,scalar:i}=Ir(t),c=W(n,32,"auxRand"),f=r.toBytes(i^De(An("BIP0340/aux",c))),a=An("BIP0340/nonce",f,s,o),{bytes:u,scalar:l}=Ir(a),b=ws(u,s,o),g=new Uint8Array(64);if(g.set(u,0),g.set(r.toBytes(r.create(l+b*i)),32),!ms(g,o,s))throw new Error("sign: Invalid signature produced");return g}function ms(e,t,n){let{Fp:r,Fn:o,BASE:s}=le,i=W(e,64,"signature"),c=W(t,void 0,"message"),f=W(n,32,"publicKey");try{let a=ys(De(f)),u=De(i.subarray(0,32));if(!r.isValidNot0(u))return!1;let l=De(i.subarray(32,64));if(!o.isValidNot0(l))return!1;let b=ws(o.toBytes(u),Ur(a),c),g=s.multiplyUnsafe(l).add(a.multiplyUnsafe(o.neg(b))),{x:p,y:d}=g.toAffine();return!(g.is0()||!Or(d)||p!==u)}catch{return!1}}var Es=(()=>{let n=(r=fe(48))=>yn(r,Sn.n);return{keygen:mn(n,bs),getPublicKey:bs,sign:Uc,verify:ms,Point:le,utils:{randomSecretKey:n,taggedHash:An,lift_x:ys,pointToBytes:Ur},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})();import{bytesToHex as qr,hexToBytes as Os}from"helpers";function Ae(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Rt(...e){let t=(o,s)=>i=>o(s(i)),n=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),r=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Nt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ae(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function kt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Tn(e,t="="){if(Ae(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Ts(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Bs(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0,o=[],s=Array.from(e);for(s.forEach(i=>{if(Ae(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let f=r;f<s.length;f++){let a=s[f],u=t*i+a;if(!Number.isSafeInteger(u)||t*i/t!==i||u-a!==t*i)throw new Error("convertRadix: carry overflow");if(i=u%n,s[f]=Math.floor(u/n),!Number.isSafeInteger(s[f])||s[f]*n+i!==u)throw new Error("convertRadix: carry overflow");if(c)s[f]?c=!1:r=f;else continue}if(o.push(i),c)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}var Is=(e,t)=>t?Is(t,e%t):e,Ln=(e,t)=>e+(t-Is(e,t));function _r(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ln(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ln(t,n)}`);let o=0,s=0,i=2**n-1,c=[];for(let f of e){if(Ae(f),f>=2**t)throw new Error(`convertRadix2: invalid data word=${f} from=${t}`);if(o=o<<t|f,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function Oc(e){return Ae(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Bs(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Bs(t,e,2**8))}}}function Xt(e,t=!1){if(Ae(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ln(8,e)>32||Ln(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return _r(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(_r(n,e,8,t))}}}function vs(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}var _c=Rt(Xt(4),Nt("0123456789ABCDEF"),kt("")),Hc=Rt(Xt(5),Nt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Tn(5),kt("")),Uu=Rt(Xt(5),Nt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Tn(5),kt("")),Ou=Rt(Xt(5),Nt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),kt(""),Ts(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),qt=Rt(Xt(6),Nt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Tn(6),kt("")),Rc=Rt(Xt(6),Nt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Tn(6),kt("")),Nr=e=>Rt(Oc(58),Nt(e),kt("")),Hr=Nr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),_u=Nr("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Hu=Nr("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),As=[0,2,3,5,6,7,9,10,11],Nc={encode(e){let t="";for(let n=0;n<e.length;n+=8){let r=e.subarray(n,n+8);t+=Hr.encode(r).padStart(As[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){let r=e.slice(n,n+11),o=As.indexOf(r.length),s=Hr.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}};var Rr=Rt(Nt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),kt("")),Ss=[996825010,642813549,513874426,1027748829,705979059];function Ke(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<Ss.length;r++)(t>>r&1)===1&&(n^=Ss[r]);return n}function Ls(e,t,n=1){let r=e.length,o=1;for(let s=0;s<r;s++){let i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Ke(o)^i>>5}o=Ke(o);for(let s=0;s<r;s++)o=Ke(o)^e.charCodeAt(s)&31;for(let s of t)o=Ke(o)^s;for(let s=0;s<6;s++)o=Ke(o);return o^=n,Rr.encode(_r([o%2**30],30,5,!1))}function Us(e){let t=e==="bech32"?1:734539939,n=Xt(5),r=n.decode,o=n.encode,s=vs(r);function i(u,l,b=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);let g=u.length+7+l.length;if(b!==!1&&g>b)throw new TypeError(`Length ${g} exceeds limit ${b}`);return u=u.toLowerCase(),`${u}1${Rr.encode(l)}${Ls(u,l,t)}`}function c(u,l=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||l!==!1&&u.length>l)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${l})`);let b=u.toLowerCase();if(u!==b&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=b;let g=u.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');let p=u.slice(0,g),d=u.slice(g+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");let h=Rr.decode(d).slice(0,-6),y=Ls(p,h,t);if(!d.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:h}}let f=vs(c);function a(u){let{prefix:l,words:b}=c(u,!1);return{prefix:l,words:b,bytes:r(b)}}return{encode:i,decode:c,decodeToBytes:a,decodeUnsafe:f,fromWords:r,fromWordsUnsafe:s,toWords:o}}var kr=Us("bech32"),Ru=Us("bech32m"),kc={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},qc=Rt(Xt(4),Nt("0123456789abcdef"),kt(""),Ts(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Cc={utf8:kc,hex:qc,base16:_c,base32:Hc,base64:qt,base64url:Rc,base58:Hr,base58xmr:Nc},Nu=`Invalid encoding type. Available types: ${Object.keys(Cc).join(", ")}`;var Ku=new TextDecoder("utf-8"),Pu=new TextEncoder;var $c=5e3;function Vc(e){return Kc("npub",_o(e))}function Dc(e,t){let n=kr.toWords(t);return kr.encode(e,n,$c)}function Kc(e,t){return Dc(e,t)}function Gu(){let e=crypto.getRandomValues(new Uint8Array(40)),n=2n**256n-0x14551231950b75fc4402da1732fc9bebfn;return(((i,c)=>{let f=i%c;return f>=0n?f:c+f})((i=>BigInt("0x"+(qr(i)||"0")))(e),n-1n)+1n).toString(16).padStart(64,"0")}function Pc(e){return Ro(Os(e))}function Mc(e){return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function jc(e){return Et(new TextEncoder().encode(Mc(e)))}function Zc(e,t){return qr(Es.sign(e,t))}function Yu(e,t,n=!0){e.pubkey??=Pc(t);let r=e.id?Os(e.id):jc(e);return e.id??=qr(r),n?e.sig??=Zc(r,t):delete e.sig,e}var js={};ro(js,{decrypt:()=>cf,encrypt:()=>sf});function In(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Cr(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function $r(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function P(e,...t){if(!$r(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Qt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Pe(e,t){P(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Un=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);var M=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Jt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),zc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!zc)throw new Error("Non little-endian hardware is not supported");function Wc(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function vt(e){if(typeof e=="string")e=Wc(e);else if($r(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function _s(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function de(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var At=(e,t)=>(Object.assign(t,e),t);function he(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),f=r?4:0,a=r?0:4;e.setUint32(t+f,i,r),e.setUint32(t+a,c,r)}var Ct=16,Dr=new Uint8Array(16),St=M(Dr),Gc=225,Yc=(e,t,n,r)=>{let o=r&1;return{s3:n<<31|r>>>1,s2:t<<31|n>>>1,s1:e<<31|t>>>1,s0:e>>>1^Gc<<24&-(o&1)}},pt=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function Xc(e){e.reverse();let t=e[15]&1,n=0;for(let r=0;r<e.length;r++){let o=e[r];e[r]=o>>>1|n,n=(o&1)<<7}return e[0]^=-t&225,e}var Qc=e=>e>64*1024?8:e>1024?4:2,On=class{constructor(t,n){this.blockLen=Ct,this.outputLen=Ct,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=vt(t),P(t,16);let r=Jt(t),o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),c=r.getUint32(12,!1),f=[];for(let p=0;p<128;p++)f.push({s0:pt(o),s1:pt(s),s2:pt(i),s3:pt(c)}),{s0:o,s1:s,s2:i,s3:c}=Yc(o,s,i,c);let a=Qc(n||1024);if(![1,2,4,8].includes(a))throw new Error(`ghash: wrong window size=${a}, should be 2, 4 or 8`);this.W=a;let l=128/a,b=this.windowSize=2**a,g=[];for(let p=0;p<l;p++)for(let d=0;d<b;d++){let h=0,y=0,m=0,T=0;for(let I=0;I<a;I++){if(!(d>>>a-I-1&1))continue;let{s0:U,s1:H,s2:k,s3:R}=f[a*p+I];h^=U,y^=H,m^=k,T^=R}g.push({s0:h,s1:y,s2:m,s3:T})}this.t=g}_updateBlock(t,n,r,o){t^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;let{W:s,t:i,windowSize:c}=this,f=0,a=0,u=0,l=0,b=(1<<s)-1,g=0;for(let p of[t,n,r,o])for(let d=0;d<4;d++){let h=p>>>8*d&255;for(let y=8/s-1;y>=0;y--){let m=h>>>s*y&b,{s0:T,s1:I,s2:N,s3:U}=i[g*c+m];f^=T,a^=I,u^=N,l^=U,g+=1}}this.s0=f,this.s1=a,this.s2=u,this.s3=l}update(t){t=vt(t),Qt(this);let n=M(t),r=Math.floor(t.length/Ct),o=t.length%Ct;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(Dr.set(t.subarray(r*Ct)),this._updateBlock(St[0],St[1],St[2],St[3]),St.fill(0)),this}destroy(){let{t}=this;for(let n of t)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(t){Qt(this),Pe(t,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=M(t);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,t}digest(){let t=new Uint8Array(Ct);return this.digestInto(t),this.destroy(),t}},Vr=class extends On{constructor(t,n){t=vt(t);let r=Xc(t.slice());super(r,n),r.fill(0)}update(t){t=vt(t),Qt(this);let n=M(t),r=t.length%Ct,o=Math.floor(t.length/Ct);for(let s=0;s<o;s++)this._updateBlock(pt(n[s*4+3]),pt(n[s*4+2]),pt(n[s*4+1]),pt(n[s*4+0]));return r&&(Dr.set(t.subarray(o*Ct)),this._updateBlock(pt(St[3]),pt(St[2]),pt(St[1]),pt(St[0])),St.fill(0)),this}digestInto(t){Qt(this),Pe(t,this),this.finished=!0;let{s0:n,s1:r,s2:o,s3:s}=this,i=M(t);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,t.reverse()}};function Hs(e){let t=(r,o)=>e(o,r.length).update(vt(r)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(r,o)=>e(r,o),t}var Kr=Hs((e,t)=>new On(e,t)),Rs=Hs((e,t)=>new Vr(e,t));var st=16,jr=4,_n=new Uint8Array(st),Jc=283;function Zr(e){return e<<1^Jc&-(e>>7)}function Se(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=Zr(e);return n}var Mr=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Zr(r))e[n]=r;let t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),Fc=Mr.map((e,t)=>Mr.indexOf(t)),tf=e=>e<<24|e>>>8,Pr=e=>e<<8|e>>>24;function Ns(e,t){if(e.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((a,u)=>t(e[u])),r=n.map(Pr),o=r.map(Pr),s=o.map(Pr),i=new Uint32Array(256*256),c=new Uint32Array(256*256),f=new Uint16Array(256*256);for(let a=0;a<256;a++)for(let u=0;u<256;u++){let l=a*256+u;i[l]=n[a]^r[u],c[l]=o[a]^s[u],f[l]=e[a]<<8|e[u]}return{sbox:e,sbox2:f,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}var zr=Ns(Mr,e=>Se(e,3)<<24|e<<16|e<<8|Se(e,2)),ks=Ns(Fc,e=>Se(e,11)<<24|Se(e,13)<<16|Se(e,9)<<8|Se(e,14)),ef=(()=>{let e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Zr(n))e[t]=n;return e})();function te(e){P(e);let t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);let{sbox2:n}=zr,r=M(e),o=r.length,s=c=>Lt(n,c,c,c,c),i=new Uint32Array(t+28);i.set(r);for(let c=o;c<i.length;c++){let f=i[c-1];c%o===0?f=s(tf(f))^ef[c/o-1]:o>6&&c%o===4&&(f=s(f)),i[c]=i[c-o]^f}return i}function qs(e){let t=te(e),n=t.slice(),r=t.length,{sbox2:o}=zr,{T0:s,T1:i,T2:c,T3:f}=ks;for(let a=0;a<r;a+=4)for(let u=0;u<4;u++)n[a+u]=t[r-a-4+u];t.fill(0);for(let a=4;a<r-4;a++){let u=n[a],l=Lt(o,u,u,u,u);n[a]=s[l&255]^i[l>>>8&255]^c[l>>>16&255]^f[l>>>24]}return n}function Ft(e,t,n,r,o,s){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|s>>>24&255]}function Lt(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function gt(e,t,n,r,o){let{sbox2:s,T01:i,T23:c}=zr,f=0;t^=e[f++],n^=e[f++],r^=e[f++],o^=e[f++];let a=e.length/4-2;for(let p=0;p<a;p++){let d=e[f++]^Ft(i,c,t,n,r,o),h=e[f++]^Ft(i,c,n,r,o,t),y=e[f++]^Ft(i,c,r,o,t,n),m=e[f++]^Ft(i,c,o,t,n,r);t=d,n=h,r=y,o=m}let u=e[f++]^Lt(s,t,n,r,o),l=e[f++]^Lt(s,n,r,o,t),b=e[f++]^Lt(s,r,o,t,n),g=e[f++]^Lt(s,o,t,n,r);return{s0:u,s1:l,s2:b,s3:g}}function Cs(e,t,n,r,o){let{sbox2:s,T01:i,T23:c}=ks,f=0;t^=e[f++],n^=e[f++],r^=e[f++],o^=e[f++];let a=e.length/4-2;for(let p=0;p<a;p++){let d=e[f++]^Ft(i,c,t,o,r,n),h=e[f++]^Ft(i,c,n,t,o,r),y=e[f++]^Ft(i,c,r,n,t,o),m=e[f++]^Ft(i,c,o,r,n,t);t=d,n=h,r=y,o=m}let u=e[f++]^Lt(s,t,o,r,n),l=e[f++]^Lt(s,n,t,o,r),b=e[f++]^Lt(s,r,n,t,o),g=e[f++]^Lt(s,o,r,n,t);return{s0:u,s1:l,s2:b,s3:g}}function Le(e,t){if(!t)return new Uint8Array(e);if(P(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function nf(e,t,n,r){P(t,st),P(n);let o=n.length;r=Le(o,r);let s=t,i=M(s),{s0:c,s1:f,s2:a,s3:u}=gt(e,i[0],i[1],i[2],i[3]),l=M(n),b=M(r);for(let p=0;p+4<=l.length;p+=4){b[p+0]=l[p+0]^c,b[p+1]=l[p+1]^f,b[p+2]=l[p+2]^a,b[p+3]=l[p+3]^u;let d=1;for(let h=s.length-1;h>=0;h--)d=d+(s[h]&255)|0,s[h]=d&255,d>>>=8;({s0:c,s1:f,s2:a,s3:u}=gt(e,i[0],i[1],i[2],i[3]))}let g=st*Math.floor(l.length/jr);if(g<o){let p=new Uint32Array([c,f,a,u]),d=Un(p);for(let h=g,y=0;h<o;h++,y++)r[h]=n[h]^d[y]}return r}function Me(e,t,n,r,o){P(n,st),P(r),o=Le(r.length,o);let s=n,i=M(s),c=Jt(s),f=M(r),a=M(o),u=t?0:12,l=r.length,b=c.getUint32(u,t),{s0:g,s1:p,s2:d,s3:h}=gt(e,i[0],i[1],i[2],i[3]);for(let m=0;m+4<=f.length;m+=4)a[m+0]=f[m+0]^g,a[m+1]=f[m+1]^p,a[m+2]=f[m+2]^d,a[m+3]=f[m+3]^h,b=b+1>>>0,c.setUint32(u,b,t),{s0:g,s1:p,s2:d,s3:h}=gt(e,i[0],i[1],i[2],i[3]);let y=st*Math.floor(f.length/jr);if(y<l){let m=new Uint32Array([g,p,d,h]),T=Un(m);for(let I=y,N=0;I<l;I++,N++)o[I]=r[I]^T[N]}return o}var cl=At({blockSize:16,nonceLength:16},function(t,n){P(t),P(n,st);function r(o,s){let i=te(t),c=n.slice(),f=nf(i,c,o,s);return i.fill(0),c.fill(0),f}return{encrypt:(o,s)=>r(o,s),decrypt:(o,s)=>r(o,s)}});function $s(e){if(P(e),e.length%st!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${st}`)}function Vs(e,t,n){let r=e.length,o=r%st;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=M(e);if(t){let f=st-o;f||(f=st),r=r+f}let i=Le(r,n),c=M(i);return{b:s,o:c,out:i}}function Ds(e,t){if(!t)return e;let n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let o=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function Ks(e){let t=new Uint8Array(16),n=M(t);t.set(e);let r=st-e.length;for(let o=st-r;o<st;o++)t[o]=r;return n}var fl=At({blockSize:16},function(t,n={}){P(t);let r=!n.disablePadding;return{encrypt:(o,s)=>{P(o);let{b:i,o:c,out:f}=Vs(o,r,s),a=te(t),u=0;for(;u+4<=i.length;){let{s0:l,s1:b,s2:g,s3:p}=gt(a,i[u+0],i[u+1],i[u+2],i[u+3]);c[u++]=l,c[u++]=b,c[u++]=g,c[u++]=p}if(r){let l=Ks(o.subarray(u*4)),{s0:b,s1:g,s2:p,s3:d}=gt(a,l[0],l[1],l[2],l[3]);c[u++]=b,c[u++]=g,c[u++]=p,c[u++]=d}return a.fill(0),f},decrypt:(o,s)=>{$s(o);let i=qs(t),c=Le(o.length,s),f=M(o),a=M(c);for(let u=0;u+4<=f.length;){let{s0:l,s1:b,s2:g,s3:p}=Cs(i,f[u+0],f[u+1],f[u+2],f[u+3]);a[u++]=l,a[u++]=b,a[u++]=g,a[u++]=p}return i.fill(0),Ds(c,r)}}}),Wr=At({blockSize:16,nonceLength:16},function(t,n,r={}){P(t),P(n,16);let o=!r.disablePadding;return{encrypt:(s,i)=>{let c=te(t),{b:f,o:a,out:u}=Vs(s,o,i),l=M(n),b=l[0],g=l[1],p=l[2],d=l[3],h=0;for(;h+4<=f.length;)b^=f[h+0],g^=f[h+1],p^=f[h+2],d^=f[h+3],{s0:b,s1:g,s2:p,s3:d}=gt(c,b,g,p,d),a[h++]=b,a[h++]=g,a[h++]=p,a[h++]=d;if(o){let y=Ks(s.subarray(h*4));b^=y[0],g^=y[1],p^=y[2],d^=y[3],{s0:b,s1:g,s2:p,s3:d}=gt(c,b,g,p,d),a[h++]=b,a[h++]=g,a[h++]=p,a[h++]=d}return c.fill(0),u},decrypt:(s,i)=>{$s(s);let c=qs(t),f=M(n),a=Le(s.length,i),u=M(s),l=M(a),b=f[0],g=f[1],p=f[2],d=f[3];for(let h=0;h+4<=u.length;){let y=b,m=g,T=p,I=d;b=u[h+0],g=u[h+1],p=u[h+2],d=u[h+3];let{s0:N,s1:U,s2:H,s3:k}=Cs(c,b,g,p,d);l[h++]=N^y,l[h++]=U^m,l[h++]=H^T,l[h++]=k^I}return c.fill(0),Ds(a,o)}}}),al=At({blockSize:16,nonceLength:16},function(t,n){P(t),P(n,16);function r(o,s,i){let c=te(t),f=o.length;i=Le(f,i);let a=M(o),u=M(i),l=s?u:a,b=M(n),g=b[0],p=b[1],d=b[2],h=b[3];for(let m=0;m+4<=a.length;){let{s0:T,s1:I,s2:N,s3:U}=gt(c,g,p,d,h);u[m+0]=a[m+0]^T,u[m+1]=a[m+1]^I,u[m+2]=a[m+2]^N,u[m+3]=a[m+3]^U,g=l[m++],p=l[m++],d=l[m++],h=l[m++]}let y=st*Math.floor(a.length/jr);if(y<f){({s0:g,s1:p,s2:d,s3:h}=gt(c,g,p,d,h));let m=Un(new Uint32Array([g,p,d,h]));for(let T=y,I=0;T<f;T++,I++)i[T]=o[T]^m[I];m.fill(0)}return c.fill(0),i}return{encrypt:(o,s)=>r(o,!0,s),decrypt:(o,s)=>r(o,!1,s)}});function Ps(e,t,n,r,o){let s=e.create(n,r.length+((o==null?void 0:o.length)||0));o&&s.update(o),s.update(r);let i=new Uint8Array(16),c=Jt(i);return o&&he(c,0,BigInt(o.length*8),t),he(c,8,BigInt(r.length*8),t),s.update(i),s.digest()}var ul=At({blockSize:16,nonceLength:12,tagLength:16},function(t,n,r){if(P(n),n.length===0)throw new Error("aes/gcm: empty nonce");let o=16;function s(c,f,a){let u=Ps(Kr,!1,c,a,r);for(let l=0;l<f.length;l++)u[l]^=f[l];return u}function i(){let c=te(t),f=_n.slice(),a=_n.slice();if(Me(c,!1,a,a,f),n.length===12)a.set(n);else{let l=_n.slice(),b=Jt(l);he(b,8,BigInt(n.length*8),!1),Kr.create(f).update(n).update(l).digestInto(a)}let u=Me(c,!1,a,_n);return{xk:c,authKey:f,counter:a,tagMask:u}}return{encrypt:c=>{P(c);let{xk:f,authKey:a,counter:u,tagMask:l}=i(),b=new Uint8Array(c.length+o);Me(f,!1,u,c,b);let g=s(a,l,b.subarray(0,b.length-o));return b.set(g,c.length),f.fill(0),b},decrypt:c=>{if(P(c),c.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);let{xk:f,authKey:a,counter:u,tagMask:l}=i(),b=c.subarray(0,-o),g=c.subarray(-o),p=s(a,l,b);if(!de(p,g))throw new Error("aes/gcm: invalid ghash tag");let d=Me(f,!1,u,b);return a.fill(0),l.fill(0),f.fill(0),d}}}),Hn=(e,t,n)=>r=>{if(!Number.isSafeInteger(r)||t>r||r>n)throw new Error(`${e}: invalid value=${r}, must be [${t}..${n}]`)},ll=At({blockSize:16,nonceLength:12,tagLength:16},function(t,n,r){let s=Hn("AAD",0,68719476736),i=Hn("plaintext",0,2**36),c=Hn("nonce",12,12),f=Hn("ciphertext",16,2**36+16);P(n),c(n.length),r&&(P(r),s(r.length));function a(){let b=t.length;if(b!==16&&b!==24&&b!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${b} bytes`);let g=te(t),p=new Uint8Array(b),d=new Uint8Array(16),h=M(n),y=0,m=h[0],T=h[1],I=h[2],N=0;for(let U of[d,p].map(M)){let H=M(U);for(let k=0;k<H.length;k+=2){let{s0:R,s1:V}=gt(g,y,m,T,I);H[k+0]=R,H[k+1]=V,y=++N}}return g.fill(0),{authKey:d,encKey:te(p)}}function u(b,g,p){let d=Ps(Rs,!0,g,p,r);for(let N=0;N<12;N++)d[N]^=n[N];d[15]&=127;let h=M(d),y=h[0],m=h[1],T=h[2],I=h[3];return{s0:y,s1:m,s2:T,s3:I}=gt(b,y,m,T,I),h[0]=y,h[1]=m,h[2]=T,h[3]=I,d}function l(b,g,p){let d=g.slice();return d[15]|=128,Me(b,!0,d,p)}return{encrypt:b=>{P(b),i(b.length);let{encKey:g,authKey:p}=a(),d=u(g,p,b),h=new Uint8Array(b.length+16);return h.set(d,b.length),h.set(l(g,d,b)),g.fill(0),p.fill(0),h},decrypt:b=>{P(b),f(b.length);let g=b.subarray(-16),{encKey:p,authKey:d}=a(),h=l(p,g,b.subarray(0,-16)),y=u(p,d,h);if(p.fill(0),d.fill(0),!de(g,y))throw new Error("invalid polyval tag");return h}}});var rf=new TextDecoder("utf-8"),of=new TextEncoder;function sf(e,t,n){let r=e instanceof Uint8Array?ct(e):e,o=Kt.getSharedSecret(r,"02"+t),s=Ms(o),i=Uint8Array.from(an(16)),c=of.encode(n),f=Wr(s,i).encrypt(c),a=qt.encode(new Uint8Array(f)),u=qt.encode(new Uint8Array(i.buffer));return`${a}?iv=${u}`}function cf(e,t,n){let r=e instanceof Uint8Array?ct(e):e,[o,s]=n.split("?iv="),i=Kt.getSharedSecret(r,"02"+t),c=Ms(i),f=qt.decode(s),a=qt.decode(o),u=Wr(c,f).decrypt(a);return rf.decode(u)}function Ms(e){return e.slice(1,33)}function Rn(e,t,n){return we(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Ve(e,n,t)}import{bytesToHex as ff}from"helpers";function Tl(e,t,n){n??="default";let r=Rn(Et,e,n);return ff(Et(r+t))}var nt=(e,t)=>e[t++]&255|(e[t++]&255)<<8,Gr=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=vt(t),P(t,32);let n=nt(t,0),r=nt(t,2),o=nt(t,4),s=nt(t,6),i=nt(t,8),c=nt(t,10),f=nt(t,12),a=nt(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|f<<5)&8065,this.r[8]=(f>>>8|a<<8)&8191,this.r[9]=a>>>5&127;for(let u=0;u<8;u++)this.pad[u]=nt(t,16+2*u)}process(t,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,c=i[0],f=i[1],a=i[2],u=i[3],l=i[4],b=i[5],g=i[6],p=i[7],d=i[8],h=i[9],y=nt(t,n+0),m=nt(t,n+2),T=nt(t,n+4),I=nt(t,n+6),N=nt(t,n+8),U=nt(t,n+10),H=nt(t,n+12),k=nt(t,n+14),R=s[0]+(y&8191),V=s[1]+((y>>>13|m<<3)&8191),$=s[2]+((m>>>10|T<<6)&8191),q=s[3]+((T>>>7|I<<9)&8191),B=s[4]+((I>>>4|N<<12)&8191),v=s[5]+(N>>>1&8191),x=s[6]+((N>>>14|U<<2)&8191),w=s[7]+((U>>>11|H<<5)&8191),A=s[8]+((H>>>8|k<<8)&8191),S=s[9]+(k>>>5|o),E=0,L=E+R*c+V*(5*h)+$*(5*d)+q*(5*p)+B*(5*g);E=L>>>13,L&=8191,L+=v*(5*b)+x*(5*l)+w*(5*u)+A*(5*a)+S*(5*f),E+=L>>>13,L&=8191;let O=E+R*f+V*c+$*(5*h)+q*(5*d)+B*(5*p);E=O>>>13,O&=8191,O+=v*(5*g)+x*(5*b)+w*(5*l)+A*(5*u)+S*(5*a),E+=O>>>13,O&=8191;let _=E+R*a+V*f+$*c+q*(5*h)+B*(5*d);E=_>>>13,_&=8191,_+=v*(5*p)+x*(5*g)+w*(5*b)+A*(5*l)+S*(5*u),E+=_>>>13,_&=8191;let j=E+R*u+V*a+$*f+q*c+B*(5*h);E=j>>>13,j&=8191,j+=v*(5*d)+x*(5*p)+w*(5*g)+A*(5*b)+S*(5*l),E+=j>>>13,j&=8191;let K=E+R*l+V*u+$*a+q*f+B*c;E=K>>>13,K&=8191,K+=v*(5*h)+x*(5*d)+w*(5*p)+A*(5*g)+S*(5*b),E+=K>>>13,K&=8191;let D=E+R*b+V*l+$*u+q*a+B*f;E=D>>>13,D&=8191,D+=v*c+x*(5*h)+w*(5*d)+A*(5*p)+S*(5*g),E+=D>>>13,D&=8191;let z=E+R*g+V*b+$*l+q*u+B*a;E=z>>>13,z&=8191,z+=v*f+x*c+w*(5*h)+A*(5*d)+S*(5*p),E+=z>>>13,z&=8191;let G=E+R*p+V*g+$*b+q*l+B*u;E=G>>>13,G&=8191,G+=v*a+x*f+w*c+A*(5*h)+S*(5*d),E+=G>>>13,G&=8191;let Q=E+R*d+V*p+$*g+q*b+B*l;E=Q>>>13,Q&=8191,Q+=v*u+x*a+w*f+A*c+S*(5*h),E+=Q>>>13,Q&=8191;let Z=E+R*h+V*d+$*p+q*g+B*b;E=Z>>>13,Z&=8191,Z+=v*l+x*u+w*a+A*f+S*c,E+=Z>>>13,Z&=8191,E=(E<<2)+E|0,E=E+L|0,L=E&8191,E=E>>>13,O+=E,s[0]=L,s[1]=O,s[2]=_,s[3]=j,s[4]=K,s[5]=D,s[6]=z,s[7]=G,s[8]=Q,s[9]=Z}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let c=2;c<10;c++)t[c]+=o,o=t[c]>>>13,t[c]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=t[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)t[c]=t[c]&s|r[c];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+n[0];t[0]=i&65535;for(let c=1;c<8;c++)i=(t[c]+n[c]|0)+(i>>>16)|0,t[c]=i&65535}update(t){Qt(this);let{buffer:n,blockLen:r}=this;t=vt(t);let o=t.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){Qt(this),Pe(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=r[i]>>>0,t[s++]=r[i]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function af(e){let t=(r,o)=>e(o).update(vt(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var Zs=af(e=>new Gr(e));var Ws=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),uf=Ws("expand 16-byte k"),lf=Ws("expand 32-byte k"),df=M(uf),Gs=M(lf),Nl=Gs.slice();function C(e,t){return e<<t|e>>>32-t}function Yr(e){return e.byteOffset%4===0}var Nn=64,hf=16,Ys=2**32-1,zs=new Uint32Array;function pf(e,t,n,r,o,s,i,c){let f=o.length,a=new Uint8Array(Nn),u=M(a),l=Yr(o)&&Yr(s),b=l?M(o):zs,g=l?M(s):zs;for(let p=0;p<f;i++){if(e(t,n,r,u,i,c),i>=Ys)throw new Error("arx: counter overflow");let d=Math.min(Nn,f-p);if(l&&d===Nn){let h=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,m;y<hf;y++)m=h+y,g[m]=b[m]^u[y];p+=Nn;continue}for(let h=0,y;h<d;h++)y=p+h,s[y]=o[y]^a[h];p+=d}}function Xr(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=_s({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return In(o),In(i),Cr(s),Cr(n),(c,f,a,u,l=0)=>{P(c),P(f),P(a);let b=a.length;if(u||(u=new Uint8Array(b)),P(u),In(l),l<0||l>=Ys)throw new Error("arx: counter overflow");if(u.length<b)throw new Error(`arx: output (${u.length}) is shorter than data (${b})`);let g=[],p=c.length,d,h;if(p===32)d=c.slice(),g.push(d),h=Gs;else if(p===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),h=df,g.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Yr(f)||(f=f.slice(),g.push(f));let y=M(d);if(r){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(h,y,M(f.subarray(0,16)),y),f=f.subarray(16)}let m=16-o;if(m!==f.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){let I=new Uint8Array(12);I.set(f,s?0:12-f.length),f=I,g.push(f)}let T=M(f);for(pf(e,h,y,T,a,u,l,i);g.length>0;)g.pop().fill(0);return u}}function Js(e,t,n,r,o,s=20){let i=e[0],c=e[1],f=e[2],a=e[3],u=t[0],l=t[1],b=t[2],g=t[3],p=t[4],d=t[5],h=t[6],y=t[7],m=o,T=n[0],I=n[1],N=n[2],U=i,H=c,k=f,R=a,V=u,$=l,q=b,B=g,v=p,x=d,w=h,A=y,S=m,E=T,L=I,O=N;for(let j=0;j<s;j+=2)U=U+V|0,S=C(S^U,16),v=v+S|0,V=C(V^v,12),U=U+V|0,S=C(S^U,8),v=v+S|0,V=C(V^v,7),H=H+$|0,E=C(E^H,16),x=x+E|0,$=C($^x,12),H=H+$|0,E=C(E^H,8),x=x+E|0,$=C($^x,7),k=k+q|0,L=C(L^k,16),w=w+L|0,q=C(q^w,12),k=k+q|0,L=C(L^k,8),w=w+L|0,q=C(q^w,7),R=R+B|0,O=C(O^R,16),A=A+O|0,B=C(B^A,12),R=R+B|0,O=C(O^R,8),A=A+O|0,B=C(B^A,7),U=U+$|0,O=C(O^U,16),w=w+O|0,$=C($^w,12),U=U+$|0,O=C(O^U,8),w=w+O|0,$=C($^w,7),H=H+q|0,S=C(S^H,16),A=A+S|0,q=C(q^A,12),H=H+q|0,S=C(S^H,8),A=A+S|0,q=C(q^A,7),k=k+B|0,E=C(E^k,16),v=v+E|0,B=C(B^v,12),k=k+B|0,E=C(E^k,8),v=v+E|0,B=C(B^v,7),R=R+V|0,L=C(L^R,16),x=x+L|0,V=C(V^x,12),R=R+V|0,L=C(L^R,8),x=x+L|0,V=C(V^x,7);let _=0;r[_++]=i+U|0,r[_++]=c+H|0,r[_++]=f+k|0,r[_++]=a+R|0,r[_++]=u+V|0,r[_++]=l+$|0,r[_++]=b+q|0,r[_++]=g+B|0,r[_++]=p+v|0,r[_++]=d+x|0,r[_++]=h+w|0,r[_++]=y+A|0,r[_++]=m+S|0,r[_++]=T+E|0,r[_++]=I+L|0,r[_++]=N+O|0}function gf(e,t,n,r){let o=e[0],s=e[1],i=e[2],c=e[3],f=t[0],a=t[1],u=t[2],l=t[3],b=t[4],g=t[5],p=t[6],d=t[7],h=n[0],y=n[1],m=n[2],T=n[3];for(let N=0;N<20;N+=2)o=o+f|0,h=C(h^o,16),b=b+h|0,f=C(f^b,12),o=o+f|0,h=C(h^o,8),b=b+h|0,f=C(f^b,7),s=s+a|0,y=C(y^s,16),g=g+y|0,a=C(a^g,12),s=s+a|0,y=C(y^s,8),g=g+y|0,a=C(a^g,7),i=i+u|0,m=C(m^i,16),p=p+m|0,u=C(u^p,12),i=i+u|0,m=C(m^i,8),p=p+m|0,u=C(u^p,7),c=c+l|0,T=C(T^c,16),d=d+T|0,l=C(l^d,12),c=c+l|0,T=C(T^c,8),d=d+T|0,l=C(l^d,7),o=o+a|0,T=C(T^o,16),p=p+T|0,a=C(a^p,12),o=o+a|0,T=C(T^o,8),p=p+T|0,a=C(a^p,7),s=s+u|0,h=C(h^s,16),d=d+h|0,u=C(u^d,12),s=s+u|0,h=C(h^s,8),d=d+h|0,u=C(u^d,7),i=i+l|0,y=C(y^i,16),b=b+y|0,l=C(l^b,12),i=i+l|0,y=C(y^i,8),b=b+y|0,l=C(l^b,7),c=c+f|0,m=C(m^c,16),g=g+m|0,f=C(f^g,12),c=c+f|0,m=C(m^c,8),g=g+m|0,f=C(f^g,7);let I=0;r[I++]=o,r[I++]=s,r[I++]=i,r[I++]=c,r[I++]=h,r[I++]=y,r[I++]=m,r[I++]=T}var kn=Xr(Js,{counterRight:!1,counterLength:4,allowShortKeys:!1}),bf=Xr(Js,{counterRight:!1,counterLength:8,extendNonceFn:gf,allowShortKeys:!1});var xf=new Uint8Array(16),Xs=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(xf.subarray(n))},yf=new Uint8Array(32);function Qs(e,t,n,r,o){let s=e(t,n,yf),i=Zs.create(s);o&&Xs(i,o),Xs(i,r);let c=new Uint8Array(16),f=Jt(c);he(f,0,BigInt(o?o.length:0),!0),he(f,8,BigInt(r.length),!0),i.update(c);let a=i.digest();return s.fill(0),a}var Fs=e=>(t,n,r)=>(P(t,32),P(n),{encrypt:(s,i)=>{let c=s.length,f=c+16;i?P(i,f):i=new Uint8Array(f),e(t,n,s,i,1);let a=Qs(e,t,n,i.subarray(0,-16),r);return i.set(a,c),i},decrypt:(s,i)=>{let c=s.length,f=c-16;if(c<16)throw new Error("encrypted data must be at least 16 bytes");i?P(i,f):i=new Uint8Array(f);let a=s.subarray(0,-16),u=s.subarray(-16),l=Qs(e,t,n,a,r);if(!de(u,l))throw new Error("invalid tag");return e(t,n,a,i,1),i}}),Dl=At({blockSize:64,nonceLength:12,tagLength:16},Fs(kn)),Kl=At({blockSize:64,nonceLength:24,tagLength:16},Fs(bf));var qn=class extends xe{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ut.hash(t);let r=Pt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return ut.exists(this),this.iHash.update(t),this}digestInto(t){ut.exists(this),ut.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Te=(e,t,n)=>new qn(e,t).update(n).digest();Te.create=(e,t)=>new qn(e,t);function ei(e,t,n){return ut.hash(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Te(e,Pt(n),Pt(t))}var Qr=new Uint8Array([0]),ti=new Uint8Array;function ni(e,t,n,r=32){if(ut.hash(e),ut.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/e.outputLen);n===void 0&&(n=ti);let s=new Uint8Array(o*e.outputLen),i=Te.create(e,t),c=i._cloneInto(),f=new Uint8Array(i.outputLen);for(let a=0;a<o;a++)Qr[0]=a+1,c.update(a===0?ti:f).update(n).update(Qr).digestInto(f),s.set(f,e.outputLen*a),i._cloneInto(c);return i.destroy(),c.destroy(),f.fill(0),Qr.fill(0),s.slice(0,r)}var wf=new TextDecoder("utf-8"),mf=new TextEncoder,ri=1,oi=65535;function Ef(e,t){let n=Kt.getSharedSecret(e,"02"+t).subarray(1,33);return ei(Zt,n,"nip44-v2")}function si(e,t){let n=ni(Zt,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Jr(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;let t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Bf(e){if(!Number.isSafeInteger(e)||e<ri||e>oi)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function vf(e){let t=mf.encode(e),n=t.length,r=Bf(n),o=new Uint8Array(Jr(n)-n);return He(r,t,o)}function Af(e){let t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<ri||t>oi||n.length!==t||e.length!==2+Jr(t))throw new Error("invalid padding");return wf.decode(n)}function ii(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=He(n,t);return Te(Zt,e,r)}function Sf(e){if(typeof e!="string")throw new Error("payload must be a valid string");let t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=qt.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Lf(e,t,n=an(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:s}=si(t,n),i=vf(e),c=kn(r,o,i),f=ii(s,c,n);return qt.encode(He(new Uint8Array([2]),n,c,f))}function Tf(e,t){let{nonce:n,ciphertext:r,mac:o}=Sf(e),{chacha_key:s,chacha_nonce:i,hmac_key:c}=si(t,n),f=ii(c,r,n);if(!de(f,o))throw new Error("invalid MAC");let a=kn(s,i,r);return Af(a)}var Fr={utils:{getConversationKey:Ef,calcPaddedLen:Jr},encrypt:Lf,decrypt:Tf};function If(e,t,n){if(n??="nip44-v2",n.length>32)throw new Error("invalid salt length");let r=xs.getSharedSecret(e,"02"+t).subarray(1,33);return Rn(Et,r,n)}var d0={encrypt:Fr.encrypt,decrypt:Fr.decrypt,getConversationKey:If};var Ie=Symbol("verified"),Uf=e=>e instanceof Object;function Of(e){if(!Uf(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var m0=new TextDecoder("utf-8"),_f=new TextEncoder;function Hf(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var Rf=class{value;next=null;prev=null;constructor(e){this.value=e}},Nf=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new Rf(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},kf=class{generateSecretKey(){return ht.utils.randomPrivateKey()}getPublicKey(e){return ct(ht.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=ct(ht.getPublicKey(t)),n.id=to(n),n.sig=ct(ht.sign(to(n),t)),n[Ie]=!0,n}verifyEvent(e){if(typeof e[Ie]=="boolean")return e[Ie];let t=to(e);if(t!==e.id)return e[Ie]=!1,!1;try{let n=ht.verify(e.sig,t,e.pubkey);return e[Ie]=n,n}catch{return e[Ie]=!1,!1}}};function qf(e){if(!Of(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function to(e){let t=Zt(_f.encode(qf(e)));return ct(t)}var Cn=new kf,E0=Cn.generateSecretKey,B0=Cn.getPublicKey,v0=Cn.finalizeEvent,Cf=Cn.verifyEvent,$f=22242;function Vf(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function Df(e,t){for(let n=0;n<e.length;n++)if(Vf(e[n],t))return!0;return!1}function Kf(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Pf(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function Mf(e,t){return{kind:$f,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function jf(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var ci=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},fi=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Nf;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Hf(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){let n=new fi(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{var r;clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored")},this.ws.onclose=n=>{var r;clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{let n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){var e,t,n;((e=this.ws)==null?void 0:e.readyState)===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(o=>setTimeout(()=>o(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,(t=this.onclose)==null||t.call(this),(n=this.ws)==null||n.close()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await jf();this.queueRunning=!1}handleNext(){var n,r;let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=Pf(e);if(t){let o=this.openSubs.get(t);if(!o)return;let s=Kf(e,"id"),i=(n=o.alreadyHaveEvent)==null?void 0:n.call(o,s);if((r=o.receivedEvent)==null||r.call(o,this,s),i)return}try{let o=JSON.parse(e);switch(o[0]){case"EVENT":{let s=this.openSubs.get(o[1]),i=o[2];this.verifyEvent(i)&&Df(s.filters,i)&&s.onevent(i);return}case"COUNT":{let s=o[1],i=o[2],c=this.openCountRequests.get(s);c&&(c.resolve(i.count),this.openCountRequests.delete(s));return}case"EOSE":{let s=this.openSubs.get(o[1]);if(!s)return;s.receivedEose();return}case"OK":{let s=o[1],i=o[2],c=o[3],f=this.openEventPublishes.get(s);f&&(clearTimeout(f.timeout),i?f.resolve(c):f.reject(new Error(c)),this.openEventPublishes.delete(s));return}case"CLOSED":{let s=o[1],i=this.openSubs.get(s);if(!i)return;i.closed=!0,i.close(o[2]);return}case"NOTICE":this.onnotice(o[1]);return;case"AUTH":{this.challenge=o[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new ci(e,this.url);this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){let t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,r)=>{try{let o=await e(Mf(this.url,t)),s=setTimeout(()=>{let i=this.openEventPublishes.get(o.id);i&&(i.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:r,timeout:s}),this.send('["AUTH",'+JSON.stringify(o)+"]")}catch(o){console.warn("subscribe auth function failed:",o)}}),this.authPromise)}async publish(e){let t=new Promise((n,r)=>{let o=setTimeout(()=>{let s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:r,timeout:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||(t.label?t.label+":":"sub:")+this.serial,r=new Zf(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e,t;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.onclose)==null||e.call(this),(t=this.ws)==null||t.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Zf=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(n){if(!(n instanceof ci))throw n}this.closed=!0}this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},ai;try{ai=WebSocket}catch{}var ui=class extends fi{constructor(e){super(e,{verifyEvent:Cf,websocketImplementation:ai})}static async connect(e){let t=new ui(e);return await t.connect(),t}};export{ui as Relay,Yu as finalizeEvent,Gu as generatePrivateKey,Pc as getPublicKey,js as nip04,d0 as nip44,Vc as npubEncode,Tl as obfuscate};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
@noble/hashes/esm/utils.js:
@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
